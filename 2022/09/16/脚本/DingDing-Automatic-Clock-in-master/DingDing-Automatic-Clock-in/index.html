<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="钉钉全自动打卡"><meta name="keywords" content="autojs,钉钉"><meta name="author" content="ZJH"><meta name="copyright" content="ZJH"><title>钉钉全自动打卡 | Zany's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">声明</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%8F%B0-%E5%AE%9A%E6%97%B6%E8%84%9A%E6%9C%AC"><span class="toc-number">1.1.</span> <span class="toc-text">⏰ 定时脚本</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Auto-js-VSCodeExt-README"><span class="toc-number">2.</span> <span class="toc-text">Auto.js-VSCodeExt README</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Install"><span class="toc-number">2.1.</span> <span class="toc-text">Install</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Features"><span class="toc-number">2.2.</span> <span class="toc-text">Features</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Usage"><span class="toc-number">2.3.</span> <span class="toc-text">Usage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-1"><span class="toc-number">2.3.1.</span> <span class="toc-text">Step 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-2"><span class="toc-number">2.3.2.</span> <span class="toc-text">Step 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-3"><span class="toc-number">2.3.3.</span> <span class="toc-text">Step 3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Commands"><span class="toc-number">2.4.</span> <span class="toc-text">Commands</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Log"><span class="toc-number">2.5.</span> <span class="toc-text">Log</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%92%89%E9%92%89%E6%89%93%E5%8D%A1%E8%84%9A%E6%9C%AC%E5%8E%9F%E6%96%87"><span class="toc-number">3.</span> <span class="toc-text">钉钉打卡脚本原文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%8F%B0-DingDing-Automatic-Clock-in"><span class="toc-number">3.1.</span> <span class="toc-text">⏰ DingDing-Automatic-Clock-in</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%96-%E7%AE%80%E4%BB%8B"><span class="toc-number">3.2.</span> <span class="toc-text">📖 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%92%A5-%E5%8A%9F%E8%83%BD"><span class="toc-number">3.3.</span> <span class="toc-text">💥 功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%99%EF%B8%8F-%E5%B7%A5%E5%85%B7"><span class="toc-number">3.4.</span> <span class="toc-text">⚙️ 工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%92%A1-%E5%8E%9F%E7%90%86"><span class="toc-number">3.5.</span> <span class="toc-text">💡 原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%9D-%E8%84%9A%E6%9C%AC"><span class="toc-number">3.6.</span> <span class="toc-text">📝 脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%90-%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.7.</span> <span class="toc-text">📐 工具介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Auto-js"><span class="toc-number">3.7.1.</span> <span class="toc-text">Auto.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tasker"><span class="toc-number">3.7.2.</span> <span class="toc-text">Tasker</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%95%B9%EF%B8%8F-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">3.8.</span> <span class="toc-text">🕹️ 使用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E6%89%93%E5%8D%A1"><span class="toc-number">3.8.1.</span> <span class="toc-text">远程打卡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9A%82%E5%81%9C-%E6%81%A2%E5%A4%8D%E5%AE%9A%E6%97%B6%E6%89%93%E5%8D%A1"><span class="toc-number">3.8.2.</span> <span class="toc-text">暂停&#x2F;恢复定时打卡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%A0%EF%B8%8F-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-%E5%BF%85%E8%AF%BB"><span class="toc-number">3.9.</span> <span class="toc-text">⚠️ 注意事项 (必读!!!)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%9C-%E6%9B%B4%E6%96%B0%E6%97%A5%E5%BF%97"><span class="toc-number">3.10.</span> <span class="toc-text">📜 更新日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2022-03-26"><span class="toc-number">3.10.1.</span> <span class="toc-text">2022-03-26</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2022-03-01"><span class="toc-number">3.10.2.</span> <span class="toc-text">2022-03-01</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2021-10-23"><span class="toc-number">3.10.3.</span> <span class="toc-text">2021-10-23</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2021-09-02"><span class="toc-number">3.10.4.</span> <span class="toc-text">2021-09-02</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2021-07-07"><span class="toc-number">3.10.5.</span> <span class="toc-text">2021-07-07</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2021-05-27"><span class="toc-number">3.10.6.</span> <span class="toc-text">2021-05-27</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2021-05-06"><span class="toc-number">3.10.7.</span> <span class="toc-text">2021-05-06</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2021-03-15"><span class="toc-number">3.10.8.</span> <span class="toc-text">2021-03-15</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2021-03-09"><span class="toc-number">3.10.9.</span> <span class="toc-text">2021-03-09</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2021-02-07"><span class="toc-number">3.10.10.</span> <span class="toc-text">2021-02-07</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2021-01-15"><span class="toc-number">3.10.11.</span> <span class="toc-text">2021-01-15</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2021-01-08"><span class="toc-number">3.10.12.</span> <span class="toc-text">2021-01-08</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2020-12-30"><span class="toc-number">3.10.13.</span> <span class="toc-text">2020-12-30</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2020-12-04"><span class="toc-number">3.10.14.</span> <span class="toc-text">2020-12-04</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2020-10-27"><span class="toc-number">3.10.15.</span> <span class="toc-text">2020-10-27</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2020-09-24"><span class="toc-number">3.10.16.</span> <span class="toc-text">2020-09-24</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96URL%E7%9A%84%E6%96%B9%E5%BC%8F%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">3.10.16.1.</span> <span class="toc-text">获取URL的方式如下：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2020-09-11"><span class="toc-number">3.10.17.</span> <span class="toc-text">2020-09-11</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2020-09-04"><span class="toc-number">3.10.18.</span> <span class="toc-text">2020-09-04</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2020-09-02"><span class="toc-number">3.10.19.</span> <span class="toc-text">2020-09-02</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%A2-%E5%A3%B0%E6%98%8E"><span class="toc-number">3.11.</span> <span class="toc-text">📢 声明</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">ZJH</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">8</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">12</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">7</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Zany's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">钉钉全自动打卡</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-09-17</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E8%84%9A%E6%9C%AC/">脚本</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h1><p>本篇文章为摘录自GitHub，自己修改了部分代码，仅作为参考，详见原文</p>
<h2 id="⏰-定时脚本"><a href="#⏰-定时脚本" class="headerlink" title="⏰ 定时脚本"></a>⏰ 定时脚本</h2><p>同时兼容定时和通知两种功能</p>
<ul>
<li>发送 “开启循环” 开启定时功能</li>
<li>发送 “关闭循环” 关闭定时功能</li>
<li>修正 “日志” 功能BUG，发送日志文件到邮箱中</li>
<li>添加 “连接” 功能，实现远程连接电脑 AutoJs Server</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Author: George Huan</span></span><br><span class="line"><span class="comment"> * @Date: 2020-08-03 09:30:30</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2022-03-26 10:56:25</span></span><br><span class="line"><span class="comment"> * @Description: DingDing-Automatic-Clock-in (Run on AutoJs)</span></span><br><span class="line"><span class="comment"> * @URL: https://github.com/georgehuan1994/DingDing-Automatic-Clock-in</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ACCOUNT = <span class="string">&quot;15868141080&quot;</span></span><br><span class="line"><span class="keyword">const</span> PASSWORD = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> QQ =              <span class="string">&quot;2757412961&quot;</span></span><br><span class="line"><span class="keyword">const</span> EMAILL_ADDRESS =  <span class="string">&quot;2757412961@qq.com&quot;</span></span><br><span class="line"><span class="keyword">const</span> SERVER_CHAN =     <span class="string">&quot;SCT171904TfSMLDvHz2oGuB8NU9NdMg1W0&quot;</span></span><br><span class="line"><span class="keyword">const</span> PUSH_DEER =       <span class="string">&quot;PushDeer发送密钥&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PUSH_METHOD = &#123;<span class="attr">QQ</span>: <span class="number">1</span>, <span class="attr">Email</span>: <span class="number">2</span>, <span class="attr">ServerChan</span>: <span class="number">3</span>, <span class="attr">PushDeer</span>: <span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认通信方式：</span></span><br><span class="line"><span class="comment">// PUSH_METHOD.QQ -- QQ</span></span><br><span class="line"><span class="comment">// PUSH_METHOD.Email -- Email </span></span><br><span class="line"><span class="comment">// PUSH_METHOD.ServerChan -- Server酱</span></span><br><span class="line"><span class="comment">// PUSH_METHOD.PushDeer -- Push Deer</span></span><br><span class="line"><span class="keyword">var</span> DEFAULT_MESSAGE_DELIVER = PUSH_METHOD.QQ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_QQ = <span class="string">&quot;com.tencent.mobileqq&quot;</span>                <span class="comment">// QQ</span></span><br><span class="line"><span class="comment">// const PACKAGE_ID_DD = &quot;com.alibaba.android.rimet&quot;           // 钉钉</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_DD = <span class="string">&quot;com.alibaba.android.rimet.zju&quot;</span>       <span class="comment">// 浙大钉</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_XMSF = <span class="string">&quot;com.xiaomi.xmsf&quot;</span>                   <span class="comment">// 小米推送服务</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_TASKER = <span class="string">&quot;net.dinglisch.android.taskerm&quot;</span>   <span class="comment">// Tasker</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_MAIL_163 = <span class="string">&quot;com.netease.mail&quot;</span>              <span class="comment">// 网易邮箱大师</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_MAIL_ANDROID = <span class="string">&quot;com.android.email&quot;</span>         <span class="comment">// 系统内置邮箱</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_PUSHDEER = <span class="string">&quot;com.pushdeer.os&quot;</span>               <span class="comment">// Push Deer</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> LOWER_BOUND = <span class="number">1</span> * <span class="number">60</span> * <span class="number">1000</span> <span class="comment">// 最小等待时间：1min</span></span><br><span class="line"><span class="keyword">const</span> UPPER_BOUND = <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span> <span class="comment">// 最大等待时间：5min</span></span><br><span class="line"><span class="keyword">const</span> ONE_MIN = <span class="number">1</span> * <span class="number">60</span> * <span class="number">1000</span> <span class="comment">// 等待时间：1min</span></span><br><span class="line"><span class="keyword">const</span> FIF_MIN = <span class="number">15</span> * <span class="number">60</span> * <span class="number">1000</span> <span class="comment">// 等待时间：0.5h</span></span><br><span class="line"><span class="keyword">const</span> HALF_AN_HOUR = <span class="number">30</span> * <span class="number">60</span> * <span class="number">1000</span> <span class="comment">// 等待时间：0.5h</span></span><br><span class="line"><span class="keyword">const</span> AN_HOUR = <span class="number">1</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span> <span class="comment">// 等待时间：1h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行时的屏幕亮度（0-255）, 需要&quot;修改系统设置&quot;权限</span></span><br><span class="line"><span class="keyword">const</span> SCREEN_BRIGHTNESS = <span class="number">20</span>    </span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否过滤通知</span></span><br><span class="line"><span class="keyword">const</span> NOTIFICATIONS_FILTER = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// PackageId白名单</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_WHITE_LIST = [PACKAGE_ID_QQ,PACKAGE_ID_DD,PACKAGE_ID_XMSF,PACKAGE_ID_MAIL_163,PACKAGE_ID_TASKER,PACKAGE_ID_PUSHDEER]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 公司的钉钉CorpId, 获取方法见 2020-09-24 更新日志。如果只加入了一家公司, 可以不填</span></span><br><span class="line"><span class="comment">// dingtalk://dingtalkclient/page/link?url=&#x27;https://attend.dingtalk.com/attend/index.html?corpId=dingca07f56daee3def1bc961a6cb783455b&#x27;</span></span><br><span class="line"><span class="keyword">const</span> CORP_ID = <span class="string">&quot;dingca07f56daee3def1bc961a6cb783455b&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// 锁屏意图, 配合 Tasker 完成锁屏动作, 具体配置方法见 2021-03-09 更新日志</span></span><br><span class="line"><span class="keyword">const</span> ACTION_LOCK_SCREEN = <span class="string">&quot;autojs.intent.action.LOCK_SCREEN&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听音量+键, 开启后无法通过音量+键调整音量, 按下音量+键：结束所有子线程</span></span><br><span class="line"><span class="keyword">const</span> OBSERVE_VOLUME_KEY = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> WEEK_DAY = [<span class="string">&quot;Sunday&quot;</span>,<span class="string">&quot;Monday&quot;</span>,<span class="string">&quot;Tuesday&quot;</span>,<span class="string">&quot;Wednesday&quot;</span>,<span class="string">&quot;Thursday&quot;</span>,<span class="string">&quot;Friday&quot;</span>,<span class="string">&quot;Saturday&quot;</span>,]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// =================== ↓↓↓ 主线程：监听通知 ↓↓↓ ====================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> currentDate = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否暂停循环打卡</span></span><br><span class="line"><span class="keyword">var</span> recursiveCard = <span class="literal">false</span></span><br><span class="line"><span class="keyword">var</span> timeAnchorPoints = [<span class="number">8</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">22</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否暂停定时打卡</span></span><br><span class="line"><span class="keyword">var</span> suspend = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 本次打开钉钉前是否需要等待</span></span><br><span class="line"><span class="keyword">var</span> needWaiting = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行日志路径</span></span><br><span class="line"><span class="keyword">var</span> globalLogFilePath = <span class="string">&quot;/sdcard/脚本/Archive/&quot;</span> + getCurrentDate() + <span class="string">&quot;-log.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查无障碍权限</span></span><br><span class="line">auto.waitFor(<span class="string">&quot;normal&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查Autojs版本</span></span><br><span class="line">requiresAutojsVersion(<span class="string">&quot;4.1.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建运行日志</span></span><br><span class="line"><span class="built_in">console</span>.setGlobalLogConfig(&#123;</span><br><span class="line">    <span class="attr">file</span>: <span class="string">&quot;/sdcard/脚本/Archive/&quot;</span> + getCurrentDate() + <span class="string">&quot;-log.txt&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机通知</span></span><br><span class="line">events.observeNotification()    </span><br><span class="line">events.on(<span class="string">&quot;notification&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    notificationHandler(n)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">events.setKeyInterceptionEnabled(<span class="string">&quot;volume_up&quot;</span>, OBSERVE_VOLUME_KEY)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (OBSERVE_VOLUME_KEY) &#123;</span><br><span class="line">    events.observeKey()</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 监听音量+键</span></span><br><span class="line">events.onKeyDown(<span class="string">&quot;volume_up&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    threads.shutDownAll()</span><br><span class="line">    device.setBrightnessMode(<span class="number">1</span>)</span><br><span class="line">    device.cancelKeepingAwake()</span><br><span class="line">    toast(<span class="string">&quot;已中断所有子线程!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以在此调试各个方法</span></span><br><span class="line">    <span class="comment">// doClock()</span></span><br><span class="line">    <span class="comment">// sendQQMsg(&quot;测试文本&quot;)</span></span><br><span class="line">    <span class="comment">// sendEmail(&quot;测试主题&quot;, &quot;测试文本&quot;, null)</span></span><br><span class="line">    <span class="comment">// sendServerChan(测试主题, 测试文本)</span></span><br><span class="line">    <span class="comment">// sendPushDeer(测试主题, 测试文本)</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">toastLog(<span class="string">&quot;监听中, 请在日志中查看记录的通知及其内容&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// =================== ↑↑↑ 主线程：监听通知 ↑↑↑ =====================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// =================== ↑↑↑ 副线程：循环打卡 ↑↑↑ =====================</span></span><br><span class="line">startRecursiveCard();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">startRecursiveCard</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(recursiveCard)&#123;</span><br><span class="line">        <span class="keyword">var</span> hour = <span class="keyword">new</span> <span class="built_in">Date</span>().getHours()</span><br><span class="line">        <span class="comment">// 直到打卡时间点 启动钉钉</span></span><br><span class="line">        <span class="keyword">while</span>(recursiveCard &amp;&amp; !existsInArray(timeAnchorPoints, hour))&#123;</span><br><span class="line">            <span class="keyword">var</span> randomTime = random(ONE_MIN, FIF_MIN)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;【循环打卡】未到时间点，进行&quot;</span> + <span class="built_in">Math</span>.floor(randomTime / <span class="number">1000</span>) + <span class="string">&quot;秒随机睡眠...&quot;</span>)</span><br><span class="line">            sleep(randomTime)</span><br><span class="line">            hour = <span class="keyword">new</span> <span class="built_in">Date</span>().getHours()</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        doClock(); <span class="comment">// 打卡</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>() + <span class="string">&quot; 【循环打卡】打卡成功&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(DEFAULT_MESSAGE_DELIVER == PUSH_METHOD.QQ)&#123;</span><br><span class="line">            sleep(<span class="number">10000</span>) <span class="comment">// 等待默认消息通知程序发送</span></span><br><span class="line">            sendQQMsg(<span class="keyword">new</span> <span class="built_in">Date</span>() + <span class="string">&quot; 【循环打卡】打卡成功&quot;</span>)</span><br><span class="line">            sendServerChan(<span class="string">&quot;【循环打卡】打卡结果&quot;</span>, <span class="keyword">new</span> <span class="built_in">Date</span>() + <span class="string">&quot; 打卡成功&quot;</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;【循环打卡】QQ&amp;ServerChan 消息发送成功...&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 直到打卡时间点 启动钉钉</span></span><br><span class="line">        <span class="keyword">while</span>(recursiveCard &amp;&amp; existsInArray(timeAnchorPoints, hour))&#123;</span><br><span class="line">            <span class="keyword">var</span> randomTime = random(ONE_MIN, FIF_MIN)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;【循环打卡】已打卡，进行&quot;</span> + <span class="built_in">Math</span>.floor(randomTime / <span class="number">1000</span>) + <span class="string">&quot;秒随机睡眠...&quot;</span>)</span><br><span class="line">            sleep(randomTime)</span><br><span class="line">            hour = <span class="keyword">new</span> <span class="built_in">Date</span>().getHours()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// =================== ↑↑↑ 副线程：循环打卡 ↑↑↑ =====================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>处理通知</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notificationHandler</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> packageId = n.getPackageName()  <span class="comment">// 获取通知包名</span></span><br><span class="line">    <span class="keyword">var</span> abstract = n.tickerText         <span class="comment">// 获取通知摘要</span></span><br><span class="line">    <span class="keyword">var</span> text = n.getText()              <span class="comment">// 获取通知文本</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 过滤 PackageId 白名单之外的应用所发出的通知</span></span><br><span class="line">    <span class="keyword">if</span> (!filterNotification(packageId, abstract, text)) &#123; </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听摘要为 &quot;定时打卡&quot; 的通知, 不一定要从 Tasker 中发出通知, 日历、定时器等App均可实现</span></span><br><span class="line">    <span class="keyword">if</span> (abstract == <span class="string">&quot;定时打卡&quot;</span> &amp;&amp; !suspend) &#123; </span><br><span class="line">        needWaiting = <span class="literal">true</span></span><br><span class="line">        threads.shutDownAll()</span><br><span class="line">        threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            doClock()</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(text) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;打卡&quot;</span>: <span class="comment">// 监听文本为 &quot;打卡&quot; 的通知</span></span><br><span class="line">            needWaiting = <span class="literal">false</span></span><br><span class="line">            <span class="comment">// threads.shutDownAll()</span></span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                doClock()</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;查询&quot;</span>: <span class="comment">// 监听文本为 &quot;查询&quot; 的通知</span></span><br><span class="line">            <span class="comment">// threads.shutDownAll()</span></span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(DEFAULT_MESSAGE_DELIVER) &#123;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.QQ:</span><br><span class="line">                        sendQQMsg(getStorageData(<span class="string">&quot;dingding&quot;</span>, <span class="string">&quot;clockResult&quot;</span>))</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.Email:</span><br><span class="line">                        sendEmail(<span class="string">&quot;考勤结果&quot;</span>, getStorageData(<span class="string">&quot;dingding&quot;</span>, <span class="string">&quot;clockResult&quot;</span>), <span class="literal">null</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.ServerChan:</span><br><span class="line">                        sendServerChan(<span class="string">&quot;考勤结果&quot;</span>, getStorageData(<span class="string">&quot;dingding&quot;</span>, <span class="string">&quot;clockResult&quot;</span>))</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.PushDeer:</span><br><span class="line">                        sendPushDeer(<span class="string">&quot;考勤结果&quot;</span>, getStorageData(<span class="string">&quot;dingding&quot;</span>, <span class="string">&quot;clockResult&quot;</span>))</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;暂停&quot;</span>: <span class="comment">// 监听文本为 &quot;暂停&quot; 的通知</span></span><br><span class="line">            suspend = <span class="literal">true</span></span><br><span class="line">            <span class="built_in">console</span>.warn(<span class="string">&quot;暂停定时打卡&quot;</span>)</span><br><span class="line">            threads.shutDownAll()</span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(DEFAULT_MESSAGE_DELIVER) &#123;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.QQ:</span><br><span class="line">                        sendQQMsg(<span class="string">&quot;修改成功, 已暂停定时打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.Email:</span><br><span class="line">                        sendEmail(<span class="string">&quot;修改成功&quot;</span>, <span class="string">&quot;已暂停定时打卡功能&quot;</span>, <span class="literal">null</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.ServerChan:</span><br><span class="line">                        sendServerChan(<span class="string">&quot;修改成功&quot;</span>, <span class="string">&quot;已暂停定时打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.PushDeer:</span><br><span class="line">                        sendPushDeer(<span class="string">&quot;修改成功&quot;</span>, <span class="string">&quot;已暂停定时打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;恢复&quot;</span>: <span class="comment">// 监听文本为 &quot;恢复&quot; 的通知</span></span><br><span class="line">            suspend = <span class="literal">false</span></span><br><span class="line">            <span class="built_in">console</span>.warn(<span class="string">&quot;恢复定时打卡&quot;</span>)</span><br><span class="line">            threads.shutDownAll()</span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(DEFAULT_MESSAGE_DELIVER) &#123;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.QQ:</span><br><span class="line">                        sendQQMsg(<span class="string">&quot;修改成功, 已恢复定时打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.Email:</span><br><span class="line">                        sendEmail(<span class="string">&quot;修改成功&quot;</span>, <span class="string">&quot;已恢复定时打卡功能&quot;</span>, <span class="literal">null</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.ServerChan:</span><br><span class="line">                        sendServerChan(<span class="string">&quot;修改成功&quot;</span>, <span class="string">&quot;已恢复定时打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.PushDeer:</span><br><span class="line">                        sendPushDeer(<span class="string">&quot;修改成功&quot;</span>, <span class="string">&quot;已恢复定时打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;日志&quot;</span>: <span class="comment">// 监听文本为 &quot;日志&quot; 的通知</span></span><br><span class="line">            <span class="comment">// threads.shutDownAll()</span></span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                sendEmail(<span class="string">&quot;获取日志&quot;</span>, globalLogFilePath, globalLogFilePath)</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;连接&quot;</span>: <span class="comment">// 连接到 Autojs Server</span></span><br><span class="line">            <span class="comment">// threads.shutDownAll()</span></span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                connectServer()</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;开启循环&quot;</span>: <span class="comment">// 每天循环打卡 早八晚十</span></span><br><span class="line">            recursiveCard = <span class="literal">true</span></span><br><span class="line">            <span class="built_in">console</span>.warn(<span class="string">&quot;每天循环打卡&quot;</span>)</span><br><span class="line">            threads.shutDownAll()</span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(DEFAULT_MESSAGE_DELIVER) &#123;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.QQ:</span><br><span class="line">                        sendQQMsg(<span class="string">&quot;开启每天循环打卡功能（早八晚十），时间点：&quot;</span> + timeAnchorPoints)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.Email:</span><br><span class="line">                        sendEmail(<span class="string">&quot;开启每天循环打卡功能（早八晚十），时间点：&quot;</span> + timeAnchorPoints, <span class="literal">null</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.ServerChan:</span><br><span class="line">                        sendServerChan(<span class="string">&quot;开启循环打卡成功&quot;</span>, <span class="string">&quot;开启每天循环打卡功能（早八晚十），时间点：&quot;</span> + timeAnchorPoints)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.PushDeer:</span><br><span class="line">                        sendPushDeer(<span class="string">&quot;开启循环打卡成功&quot;</span>, <span class="string">&quot;开启每天循环打卡功能（早八晚十），时间点：&quot;</span> + timeAnchorPoints)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                startRecursiveCard();</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;关闭循环&quot;</span>: <span class="comment">// 每天循环打卡 早八晚十</span></span><br><span class="line">            recursiveCard = <span class="literal">false</span></span><br><span class="line">            <span class="built_in">console</span>.warn(<span class="string">&quot;关闭每天循环打卡&quot;</span>)</span><br><span class="line">            threads.shutDownAll()</span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(DEFAULT_MESSAGE_DELIVER) &#123;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.QQ:</span><br><span class="line">                        sendQQMsg(<span class="string">&quot;关闭每天循环打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.Email:</span><br><span class="line">                        sendEmail(<span class="string">&quot;关闭每天循环打卡功能&quot;</span>, <span class="literal">null</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.ServerChan:</span><br><span class="line">                        sendServerChan(<span class="string">&quot;关闭循环打卡成功&quot;</span>, <span class="string">&quot;关闭每天循环打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.PushDeer:</span><br><span class="line">                        sendPushDeer(<span class="string">&quot;关闭循环打卡成功&quot;</span>, <span class="string">&quot;关闭每天循环打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (text == <span class="literal">null</span>) </span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听钉钉返回的考勤结果</span></span><br><span class="line">    <span class="comment">// if (packageId == PACKAGE_ID_DD &amp;&amp; text.indexOf(&quot;考勤打卡&quot;) &gt;= 0) &#123; </span></span><br><span class="line">    <span class="keyword">if</span> (packageId == PACKAGE_ID_DD) &#123; </span><br><span class="line">        setStorageData(<span class="string">&quot;dingding&quot;</span>, <span class="string">&quot;clockResult&quot;</span>, text)</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;监听钉钉返回的消息...&quot;</span>)</span><br><span class="line">        <span class="comment">// threads.shutDownAll()</span></span><br><span class="line">        threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span>(DEFAULT_MESSAGE_DELIVER) &#123;</span><br><span class="line">                <span class="keyword">case</span> PUSH_METHOD.QQ:</span><br><span class="line">                    sendQQMsg(text)</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PUSH_METHOD.Email:</span><br><span class="line">                    sendEmail(<span class="string">&quot;考勤结果&quot;</span>, text, cameraFilePath)</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PUSH_METHOD.ServerChan:</span><br><span class="line">                    sendServerChan(<span class="string">&quot;考勤结果&quot;</span>, text)</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PUSH_METHOD.PushDeer:</span><br><span class="line">                    sendPushDeer(<span class="string">&quot;考勤结果&quot;</span>, text)</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>打卡流程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doClock</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    currentDate = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;本地时间: &quot;</span> + getCurrentDate() + <span class="string">&quot; &quot;</span> + getCurrentTime())</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;开始打卡流程!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    brightScreen()      <span class="comment">// 唤醒屏幕</span></span><br><span class="line">    unlockScreen()      <span class="comment">// 解锁屏幕</span></span><br><span class="line">    holdOn()            <span class="comment">// 随机等待</span></span><br><span class="line">    signIn()            <span class="comment">// 自动登录</span></span><br><span class="line">    handleLate()        <span class="comment">// 处理迟到</span></span><br><span class="line">    attendKaoqin()      <span class="comment">// 考勤打卡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textContains(<span class="string">&quot;上班打卡&quot;</span>).findOne(<span class="number">1000</span>)) </span><br><span class="line">    clockIn()           <span class="comment">// 上班打卡</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="literal">null</span> != textContains(<span class="string">&quot;下班打卡&quot;</span>).findOne(<span class="number">1000</span>)) </span><br><span class="line">    clockOut()          <span class="comment">// 下班打卡</span></span><br><span class="line">    </span><br><span class="line">    lockScreen()        <span class="comment">// 关闭屏幕</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>发送邮件流程</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>title 邮件主题</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>message 邮件正文</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>attachFilePath 要发送的附件路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendEmail</span>(<span class="params">title, message, attachFilePath</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;开始发送邮件流程!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    brightScreen()      <span class="comment">// 唤醒屏幕</span></span><br><span class="line">    unlockScreen()      <span class="comment">// 解锁屏幕</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 内置电子邮件</span></span><br><span class="line">    app.launch(<span class="string">&quot;com.android.email&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;等待邮箱启动...&quot;</span>)</span><br><span class="line">    sleep(<span class="number">3000</span>) <span class="comment">// 等待邮箱启动</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(attachFilePath != <span class="literal">null</span> &amp;&amp; files.exists(attachFilePath)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(attachFilePath)</span><br><span class="line">        app.sendEmail(&#123;</span><br><span class="line">            <span class="attr">email</span>: [EMAILL_ADDRESS], <span class="attr">subject</span>: title, <span class="attr">text</span>: message, <span class="attr">attachment</span>: <span class="string">&quot;file://&quot;</span> + attachFilePath</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(attachFilePath)</span><br><span class="line">        app.sendEmail(&#123;</span><br><span class="line">            <span class="attr">email</span>: [EMAILL_ADDRESS], <span class="attr">subject</span>: title, <span class="attr">text</span>: message</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 选择邮箱应用，系统默认应用即可</span></span><br><span class="line">    <span class="keyword">var</span> emailText = text(<span class="string">&quot;电子邮件&quot;</span>).findOne(<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">null</span> == emailText)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;邮箱应用选择失败...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    emailText.parent().click();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;邮箱应用选择成功...&quot;</span>)</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 点击发送按钮</span></span><br><span class="line">    <span class="keyword">var</span> sendBtn = desc(<span class="string">&quot;发送&quot;</span>).findOne(<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">null</span> == sendBtn)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;邮箱发送失败...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sendBtn.click()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;正在发送邮件...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// =============================================================================================================</span></span><br><span class="line">    <span class="comment">// console.log(&quot;选择邮件应用&quot;)</span></span><br><span class="line">    <span class="comment">// waitForActivity(&quot;com.android.internal.app.ChooserActivity&quot;) // 等待选择应用界面弹窗出现, 如果设置了默认应用就注释掉</span></span><br><span class="line">    <span class="comment">// id(&quot;compose_send_btn&quot;).findOne().click()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// var emailAppName = app.getAppName(PACKAGE_ID_MAIL_163)</span></span><br><span class="line">    <span class="comment">// if (null != emailAppName) &#123;</span></span><br><span class="line">    <span class="comment">//     if (null != textMatches(emailAppName).findOne(1000)) &#123;</span></span><br><span class="line">    <span class="comment">//         btn_email = textMatches(emailAppName).findOnce().parent()</span></span><br><span class="line">    <span class="comment">//         btn_email.click()</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// else &#123;</span></span><br><span class="line">    <span class="comment">//     console.error(&quot;不存在应用: &quot; + PACKAGE_ID_MAIL_163)</span></span><br><span class="line">    <span class="comment">//     lockScreen()</span></span><br><span class="line">    <span class="comment">//     return;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// // 网易邮箱大师</span></span><br><span class="line">    <span class="comment">// var versoin = getPackageVersion(PACKAGE_ID_MAIL_163)</span></span><br><span class="line">    <span class="comment">// console.log(&quot;应用版本: &quot; + versoin)</span></span><br><span class="line">    <span class="comment">// var sp = versoin.split(&quot;.&quot;)</span></span><br><span class="line">    <span class="comment">// if (sp[0] == 6) &#123;</span></span><br><span class="line">    <span class="comment">//     // 网易邮箱大师 6</span></span><br><span class="line">    <span class="comment">//     waitForActivity(&quot;com.netease.mobimail.activity.MailComposeActivity&quot;)</span></span><br><span class="line">    <span class="comment">//     id(&quot;send&quot;).findOne().click()</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// else &#123;</span></span><br><span class="line">    <span class="comment">//     // 网易邮箱大师 7</span></span><br><span class="line">    <span class="comment">//     waitForActivity(&quot;com.netease.mobimail.module.mailcompose.MailComposeActivity&quot;)</span></span><br><span class="line">    <span class="comment">//     var input_address = id(&quot;input&quot;).findOne()</span></span><br><span class="line">    <span class="comment">//     if (null == input_address.getText()) &#123;</span></span><br><span class="line">    <span class="comment">//         input_address.setText(EMAILL_ADDRESS)</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">//     id(&quot;iv_arrow&quot;).findOne().click()</span></span><br><span class="line">    <span class="comment">//     sleep(1000)</span></span><br><span class="line">    <span class="comment">//     id(&quot;img_send_bg&quot;).findOne().click()</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    home()</span><br><span class="line">    sleep(<span class="number">2000</span>)</span><br><span class="line">    lockScreen()    <span class="comment">// 关闭屏幕</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>发送QQ消息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>message 消息内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendQQMsg</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;发送QQ消息&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    brightScreen()      <span class="comment">// 唤醒屏幕</span></span><br><span class="line">    unlockScreen()      <span class="comment">// 解锁屏幕</span></span><br><span class="line"></span><br><span class="line">    app.startActivity(&#123; </span><br><span class="line">        <span class="attr">action</span>: <span class="string">&quot;android.intent.action.VIEW&quot;</span>, </span><br><span class="line">        <span class="attr">data</span>:<span class="string">&quot;mqq://im/chat?chat_type=wpa&amp;version=1&amp;src_type=web&amp;uin=&quot;</span> + QQ, </span><br><span class="line">        <span class="attr">packageName</span>: <span class="string">&quot;com.tencent.mobileqq&quot;</span>, </span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// waitForActivity(&quot;com.tencent.mobileqq.activity.SplashActivity&quot;)</span></span><br><span class="line"></span><br><span class="line">    id(<span class="string">&quot;input&quot;</span>).findOne().setText(message)</span><br><span class="line">    id(<span class="string">&quot;fun_btn&quot;</span>).findOne().click()</span><br><span class="line"></span><br><span class="line">    home()</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">    lockScreen()    <span class="comment">// 关闭屏幕</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>ServerChan推送</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>title 标题</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>message 消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">sendServerChan</span>(<span class="params">title, message</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;向 ServerChan 发起推送请求&quot;</span>)</span><br><span class="line"></span><br><span class="line">    url = <span class="string">&quot;https://sctapi.ftqq.com/&quot;</span> + SERVER_CHAN + <span class="string">&quot;.send&quot;</span>;</span><br><span class="line"></span><br><span class="line">    res = http.post(<span class="built_in">encodeURI</span>(url), &#123;</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: title,</span><br><span class="line">        <span class="string">&quot;desp&quot;</span>: message</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">    lockScreen()    <span class="comment">// 关闭屏幕</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>PushDeer推送</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>title 标题</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>message 消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">sendPushDeer</span>(<span class="params">title, message</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;向 PushDeer 发起推送请求&quot;</span>)</span><br><span class="line"></span><br><span class="line">    url = <span class="string">&quot;https://api2.pushdeer.com/message/push&quot;</span></span><br><span class="line"></span><br><span class="line">    res = http.post(<span class="built_in">encodeURI</span>(url), &#123;</span><br><span class="line">        <span class="string">&quot;pushkey&quot;</span>: PUSH_DEER,</span><br><span class="line">        <span class="string">&quot;text&quot;</span>: title,</span><br><span class="line">        <span class="string">&quot;desp&quot;</span>: message,</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;markdown&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">    lockScreen()    <span class="comment">// 关闭屏幕</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>唤醒设备</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">brightScreen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;唤醒设备&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    device.setBrightnessMode(<span class="number">0</span>) <span class="comment">// 手动亮度模式</span></span><br><span class="line">    device.setBrightness(SCREEN_BRIGHTNESS)</span><br><span class="line">    device.wakeUpIfNeeded() <span class="comment">// 唤醒设备</span></span><br><span class="line">    device.keepScreenOn()   <span class="comment">// 保持亮屏</span></span><br><span class="line">    sleep(<span class="number">1000</span>) <span class="comment">// 等待屏幕亮起</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!device.isScreenOn()) &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;设备未唤醒, 重试&quot;</span>)</span><br><span class="line">        device.wakeUpIfNeeded()</span><br><span class="line">        brightScreen()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(<span class="string">&quot;设备已唤醒&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>解锁屏幕</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unlockScreen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;解锁屏幕&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (isDeviceLocked()) &#123;</span><br><span class="line"></span><br><span class="line">        gesture(</span><br><span class="line">            <span class="number">320</span>, <span class="comment">// 滑动时间：毫秒</span></span><br><span class="line">            [</span><br><span class="line">                device.width  * <span class="number">0.5</span>,    <span class="comment">// 滑动起点 x 坐标：屏幕宽度的一半</span></span><br><span class="line">                device.height * <span class="number">0.9</span>     <span class="comment">// 滑动起点 y 坐标：距离屏幕底部 10% 的位置, 华为系统需要往上一些</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">                device.width / <span class="number">2</span>,       <span class="comment">// 滑动终点 x 坐标：屏幕宽度的一半</span></span><br><span class="line">                device.height * <span class="number">0.1</span>     <span class="comment">// 滑动终点 y 坐标：距离屏幕顶部 10% 的位置</span></span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">1000</span>) <span class="comment">// 等待解锁动画完成</span></span><br><span class="line">        home()</span><br><span class="line">        sleep(<span class="number">1000</span>) <span class="comment">// 等待返回动画完成</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isDeviceLocked()) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">&quot;上滑解锁失败, 请按脚本中的注释调整 gesture(time, [x1,y1], [x2,y2]) 方法的参数!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">&quot;屏幕已解锁&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>随机等待</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">holdOn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!needWaiting) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> randomTime = random(LOWER_BOUND, UPPER_BOUND)</span><br><span class="line">    toastLog(<span class="built_in">Math</span>.floor(randomTime / <span class="number">1000</span>) + <span class="string">&quot;秒后启动&quot;</span> + app.getAppName(PACKAGE_ID_DD) + <span class="string">&quot;...&quot;</span>)</span><br><span class="line">    sleep(randomTime)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>启动并登陆钉钉</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">signIn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    app.launchPackage(PACKAGE_ID_DD)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;正在启动&quot;</span> + app.getAppName(PACKAGE_ID_DD) + <span class="string">&quot;...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    setVolume(<span class="number">0</span>) <span class="comment">// 设备静音</span></span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">10000</span>) <span class="comment">// 等待钉钉启动</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (currentPackage() == PACKAGE_ID_DD &amp;&amp;</span><br><span class="line">        currentActivity() == <span class="string">&quot;com.alibaba.android.user.login.SignUpWithPwdActivity&quot;</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(<span class="string">&quot;账号未登录&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> account = id(<span class="string">&quot;et_phone_input&quot;</span>).findOne()</span><br><span class="line">        account.setText(ACCOUNT)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;输入账号&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> password = id(<span class="string">&quot;et_pwd_login&quot;</span>).findOne()</span><br><span class="line">        password.setText(PASSWORD)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;输入密码&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> privacy = id(<span class="string">&quot;cb_privacy&quot;</span>).findOne(<span class="number">1000</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> != privacy)&#123;</span><br><span class="line">            privacy.click()</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;同意隐私协议&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> btn_login = id(<span class="string">&quot;btn_next&quot;</span>).findOne()</span><br><span class="line">        btn_login.click()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;正在登陆...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">3000</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (currentPackage() == PACKAGE_ID_DD &amp;&amp;</span><br><span class="line">        currentActivity() != <span class="string">&quot;com.alibaba.android.user.login.SignUpWithPwdActivity&quot;</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(<span class="string">&quot;账号已登录&quot;</span>)</span><br><span class="line">        sleep(<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>处理迟到打卡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleLate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textMatches(<span class="string">&quot;迟到打卡&quot;</span>).clickable(<span class="literal">true</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        btn_late = textMatches(<span class="string">&quot;迟到打卡&quot;</span>).clickable(<span class="literal">true</span>).findOnce() </span><br><span class="line">        btn_late.click()</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;迟到打卡&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != descMatches(<span class="string">&quot;迟到打卡&quot;</span>).clickable(<span class="literal">true</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        btn_late = descMatches(<span class="string">&quot;迟到打卡&quot;</span>).clickable(<span class="literal">true</span>).findOnce() </span><br><span class="line">        btn_late.click()</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;迟到打卡&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>使用 URL Scheme 进入考勤界面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">attendKaoqin</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> url_scheme = <span class="string">&quot;dingtalk://dingtalkclient/page/link?url=https://attend.dingtalk.com/attend/index.html&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(CORP_ID != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        url_scheme = url_scheme + <span class="string">&quot;?corpId=&quot;</span> + CORP_ID</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a = app.intent(&#123;</span><br><span class="line">        <span class="comment">// action: &quot;VIEW&quot;,</span></span><br><span class="line">        <span class="attr">action</span>: <span class="string">&quot;android.intent.action.VIEW&quot;</span>, </span><br><span class="line">        <span class="attr">data</span>: url_scheme,</span><br><span class="line">        <span class="comment">//flags: [Intent.FLAG_ACTIVITY_NEW_TASK]</span></span><br><span class="line">    &#125;);</span><br><span class="line">    app.startActivity(a);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;正在进入考勤界面...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    textContains(<span class="string">&quot;申请&quot;</span>).waitFor()</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">&quot;已进入考勤界面&quot;</span>)</span><br><span class="line">    sleep(<span class="number">8000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>上班打卡 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clockIn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;上班打卡...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if (null != textContains(&quot;已打卡&quot;).findOne(1000)) &#123;</span></span><br><span class="line">    <span class="comment">//     console.info(&quot;已打卡&quot;)</span></span><br><span class="line">    <span class="comment">//     toast(&quot;已打卡&quot;)</span></span><br><span class="line">    <span class="comment">//     home()</span></span><br><span class="line">    <span class="comment">//     sleep(1000)</span></span><br><span class="line">    <span class="comment">//     return;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;等待连接到考勤机...&quot;</span>)</span><br><span class="line">    sleep(<span class="number">2000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textContains(<span class="string">&quot;未连接&quot;</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">&quot;未连接考勤机, 重新进入考勤界面!&quot;</span>)</span><br><span class="line">        back()</span><br><span class="line">        sleep(<span class="number">2000</span>)</span><br><span class="line">        attendKaoqin()</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    textContains(<span class="string">&quot;已连接&quot;</span>).waitFor()</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">&quot;已连接考勤机&quot;</span>)</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textMatches(<span class="string">&quot;上班打卡&quot;</span>).clickable(<span class="literal">true</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        btn_clockin = textMatches(<span class="string">&quot;上班打卡&quot;</span>).clickable(<span class="literal">true</span>).findOnce()</span><br><span class="line">        btn_clockin.click()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;按下打卡按钮&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        click(device.width / <span class="number">2</span>, device.height * <span class="number">0.560</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;点击打卡按钮坐标&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">    handleLate() <span class="comment">// 处理迟到打卡</span></span><br><span class="line">    </span><br><span class="line">    home()</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>下班打卡 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clockOut</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;下班打卡...&quot;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;等待连接到考勤机...&quot;</span>)</span><br><span class="line">    sleep(<span class="number">2000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textContains(<span class="string">&quot;未连接&quot;</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">&quot;未连接考勤机, 重新进入考勤界面!&quot;</span>)</span><br><span class="line">        back()</span><br><span class="line">        sleep(<span class="number">2000</span>)</span><br><span class="line">        attendKaoqin()</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    textContains(<span class="string">&quot;已连接&quot;</span>).waitFor()</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">&quot;已连接考勤机&quot;</span>)</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textMatches(<span class="string">&quot;下班打卡&quot;</span>).clickable(<span class="literal">true</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        btn_clockout = textMatches(<span class="string">&quot;下班打卡&quot;</span>).clickable(<span class="literal">true</span>).findOnce()</span><br><span class="line">        btn_clockout.click()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;按下打卡按钮&quot;</span>)</span><br><span class="line">        sleep(<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        click(device.width / <span class="number">2</span>, device.height * <span class="number">0.560</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;点击打卡按钮坐标&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textContains(<span class="string">&quot;早退打卡&quot;</span>).clickable(<span class="literal">true</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        className(<span class="string">&quot;android.widget.Button&quot;</span>).text(<span class="string">&quot;早退打卡&quot;</span>).clickable(<span class="literal">true</span>).findOnce().parent().click()</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;早退打卡&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    home()</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>锁屏</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lockScreen</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;关闭屏幕&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 锁屏方案1：Root</span></span><br><span class="line">    <span class="comment">// Power()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 锁屏方案2：No Root</span></span><br><span class="line">    <span class="comment">// press(Math.floor(device.width / 2), Math.floor(device.height * 0.973), 1000) // 小米的快捷手势：长按Home键锁屏</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 万能锁屏方案：向Tasker发送广播, 触发系统锁屏动作。配置方法见 2021-03-09 更新日志</span></span><br><span class="line">    app.sendBroadcast(&#123;<span class="attr">action</span>: ACTION_LOCK_SCREEN&#125;);</span><br><span class="line"></span><br><span class="line">    device.setBrightnessMode(<span class="number">1</span>) <span class="comment">// 自动亮度模式</span></span><br><span class="line">    device.cancelKeepingAwake() <span class="comment">// 取消设备常亮</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (isDeviceLocked()) &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(<span class="string">&quot;屏幕已关闭&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">&quot;屏幕未关闭, 请尝试其他锁屏方案, 或等待屏幕自动关闭&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>连接 AutoJs Server</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">connectServer</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;开始连接 AutoJs Server!&quot;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;本地时间: &quot;</span> + getCurrentDate() + <span class="string">&quot; &quot;</span> + getCurrentTime())</span><br><span class="line"></span><br><span class="line">    brightScreen()      <span class="comment">// 唤醒屏幕</span></span><br><span class="line">    unlockScreen()      <span class="comment">// 解锁屏幕</span></span><br><span class="line"></span><br><span class="line">    connectAutoJsServer() <span class="comment">// 连接 AutoJs Server</span></span><br><span class="line">    </span><br><span class="line">    lockScreen()        <span class="comment">// 关闭屏幕</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>启动 AutoJs Server 整体流程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">connectAutoJsServer</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    launchApp(<span class="string">&quot;Auto.js&quot;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;正在启动 Auto.js...&quot;</span>)</span><br><span class="line">    sleep(<span class="number">10000</span>) <span class="comment">// 等待 Auto.js 启动</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开侧拉菜单</span></span><br><span class="line">    <span class="keyword">var</span> menuBtn = className(<span class="string">&quot;android.widget.ImageButton&quot;</span>).desc(<span class="string">&quot;打开侧拉菜单&quot;</span>).clickable(<span class="literal">true</span>).findOne(<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">null</span> != menuBtn)&#123;</span><br><span class="line">        menuBtn.click();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;打开侧拉菜单...&quot;</span>)</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 滚动屏幕找到连接电脑按钮</span></span><br><span class="line">    <span class="keyword">var</span> menu = id(<span class="string">&quot;drawer_menu&quot;</span>).findOne(<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">null</span> == menu)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;滚动屏幕未找到连接电脑按钮...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    menu.scrollForward()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;滚动屏幕找到连接电脑按钮...&quot;</span>)</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 连接电脑</span></span><br><span class="line">    <span class="keyword">var</span> textCon = className(<span class="string">&quot;android.widget.TextView&quot;</span>).text(<span class="string">&quot;连接电脑&quot;</span>).findOne(<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">null</span> != textCon)&#123;</span><br><span class="line">        <span class="comment">// 寻找按钮（Switch）</span></span><br><span class="line">        <span class="keyword">var</span> layerCon = textCon.parent();</span><br><span class="line">        <span class="keyword">var</span> switchBtn = layerCon.children().findOne(className(<span class="string">&quot;android.widget.Switch&quot;</span>));</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;找到连接电脑按钮，按钮状态为：&quot;</span> + switchBtn.text() + <span class="string">&quot; &quot;</span> + switchBtn.checked() +  <span class="string">&quot;...&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(switchBtn.checked() == <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="comment">// 按下按钮</span></span><br><span class="line">            switchBtn.click();</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;开始连接电脑...&quot;</span>)</span><br><span class="line">            sleep(<span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 点击确定</span></span><br><span class="line">            <span class="keyword">var</span> okBtn = text(<span class="string">&quot;确定&quot;</span>).findOne(<span class="number">1000</span>);</span><br><span class="line">            okBtn.click();</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;连接电脑成功...&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    sleep(<span class="number">1000</span>) <span class="comment">// 等待解锁动画完成</span></span><br><span class="line">    home()</span><br><span class="line">    sleep(<span class="number">1000</span>) <span class="comment">// 等待返回动画完成</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// console.log(&quot;==========================================================&quot;);</span></span><br><span class="line">    <span class="comment">// id(&quot;drawer_menu&quot;).findOne().children().forEach(child =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//     var target = child.findOne(id(&quot;sw&quot;));</span></span><br><span class="line">    <span class="comment">//     console.log(target);</span></span><br><span class="line">    <span class="comment">//     &#125;);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ===================== ↓↓↓ 功能函数 ↓↓↓ =======================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dateDigitToString</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num &lt; <span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span> + num : num</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentTime</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> currentDate = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    <span class="keyword">var</span> hours = dateDigitToString(currentDate.getHours())</span><br><span class="line">    <span class="keyword">var</span> minute = dateDigitToString(currentDate.getMinutes())</span><br><span class="line">    <span class="keyword">var</span> second = dateDigitToString(currentDate.getSeconds())</span><br><span class="line">    <span class="keyword">var</span> formattedTimeString = hours + <span class="string">&#x27;:&#x27;</span> + minute + <span class="string">&#x27;:&#x27;</span> + second</span><br><span class="line">    <span class="keyword">return</span> formattedTimeString</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentDate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> currentDate = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    <span class="keyword">var</span> year = dateDigitToString(currentDate.getFullYear())</span><br><span class="line">    <span class="keyword">var</span> month = dateDigitToString(currentDate.getMonth() + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">var</span> date = dateDigitToString(currentDate.getDate())</span><br><span class="line">    <span class="keyword">var</span> week = currentDate.getDay()</span><br><span class="line">    <span class="keyword">var</span> formattedDateString = year + <span class="string">&#x27;-&#x27;</span> + month + <span class="string">&#x27;-&#x27;</span> + date + <span class="string">&#x27;-&#x27;</span> + WEEK_DAY[week]</span><br><span class="line">    <span class="keyword">return</span> formattedDateString</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">existsInArray</span>(<span class="params">arr, element</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;arr.length; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[i] == element) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通知过滤器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterNotification</span>(<span class="params">bundleId, abstract, text</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> check = PACKAGE_ID_WHITE_LIST.some(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;<span class="keyword">return</span> bundleId == item&#125;) </span><br><span class="line">    <span class="keyword">if</span> (!NOTIFICATIONS_FILTER || check) &#123;</span><br><span class="line">        <span class="built_in">console</span>.verbose(bundleId)</span><br><span class="line">        <span class="built_in">console</span>.verbose(abstract)</span><br><span class="line">        <span class="built_in">console</span>.verbose(text)</span><br><span class="line">        <span class="built_in">console</span>.verbose(<span class="string">&quot;---------------------------&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存本地数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setStorageData</span>(<span class="params">name, key, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> storage = storages.create(name)  <span class="comment">// 创建storage对象</span></span><br><span class="line">    storage.put(key, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取本地数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getStorageData</span>(<span class="params">name, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> storage = storages.create(name)</span><br><span class="line">    <span class="keyword">if</span> (storage.contains(key)) &#123;</span><br><span class="line">        <span class="keyword">return</span> storage.get(key, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 默认返回undefined</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除本地数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delStorageData</span>(<span class="params">name, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> storage = storages.create(name)</span><br><span class="line">    <span class="keyword">if</span> (storage.contains(key)) &#123;</span><br><span class="line">        storage.remove(key)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取应用版本号</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPackageVersion</span>(<span class="params">bundleId</span>) </span>&#123;</span><br><span class="line">    importPackage(android.content)</span><br><span class="line">    <span class="keyword">var</span> pckMan = context.getPackageManager()</span><br><span class="line">    <span class="keyword">var</span> packageInfo = pckMan.getPackageInfo(bundleId, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> packageInfo.versionName</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 屏幕是否为锁定状态</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isDeviceLocked</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    importClass(android.app.KeyguardManager)</span><br><span class="line">    importClass(android.content.Context)</span><br><span class="line">    <span class="keyword">var</span> km = context.getSystemService(Context.KEYGUARD_SERVICE)</span><br><span class="line">    <span class="keyword">return</span> km.isKeyguardLocked()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置媒体和通知音量</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setVolume</span>(<span class="params">volume</span>) </span>&#123;</span><br><span class="line">    device.setMusicVolume(volume)</span><br><span class="line">    device.setNotificationVolume(volume)</span><br><span class="line">    <span class="built_in">console</span>.verbose(<span class="string">&quot;媒体音量:&quot;</span> + device.getMusicVolume())</span><br><span class="line">    <span class="built_in">console</span>.verbose(<span class="string">&quot;通知音量:&quot;</span> + device.getNotificationVolume())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Auto-js-VSCodeExt-README"><a href="#Auto-js-VSCodeExt-README" class="headerlink" title="Auto.js-VSCodeExt README"></a>Auto.js-VSCodeExt README</h1><p>桌面编辑器Visual Studio Code的插件。可以让Visual Studio Code支持<a target="_blank" rel="noopener" href="https://github.com/hyb1996/NoRootScriptDroid">Auto.js</a>开发。</p>
<h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><p>在VS Code中菜单”查看”-&gt;”扩展”-&gt;输入”Auto.js”或”hyb1996”搜索，即可看到”Auto.js-VSCodeExt”插件，安装即可。插件的更新也可以在这里更新。</p>
<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><p>目前功能比较基础，仅支持：</p>
<ul>
<li>在VS Code的开发者工具实时显示Auto.js的日志与输出</li>
<li>在VS Code命令中增加Run, Stop, Rerun, Stop all等选项。可以在手机与电脑连接后把Sublime编辑器中的脚本推送到AutoJs中执行，或者停止AutoJs中运行的脚本。</li>
</ul>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h3><p>按 <code>Ctrl+Shift+P</code> 或点击”查看”-&gt;”命令面板”可调出命令面板，输入 <code>Auto.js</code> 可以看到几个命令，移动光标到命令<code>Auto.js: Start Server</code>，按回车键执行该命令。</p>
<p>此时VS Code会在右上角显示”Auto.js server running”，即开启服务成功。</p>
<h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><p>将手机连接到电脑启用的Wifi或者同一局域网中。通过命令行ipconfig(或者其他操作系统的相同功能命令)查看电脑的IP地址。在<a target="_blank" rel="noopener" href="https://github.com/hyb1996/Auto.js">Auto.js</a>的侧拉菜单中启用调试服务，并输入IP地址，等待连接成功。</p>
<h3 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h3><p>之后就可以在电脑上编辑JavaScript文件并通过命令<code>Run</code>或者按键<code>F5</code>在手机上运行了。</p>
<h2 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h2><p>按 <code>Ctrl+Shift+P</code> 或点击”查看”-&gt;”命令面板”可调出命令面板，输入 <code>Auto.js</code> 可以看到几个命令：</p>
<ul>
<li>Start Server: 启动插件服务。之后在确保手机和电脑在同一区域网的情况下，在Auto.js的侧拉菜单中使用连接电脑功能连接。</li>
<li>Stop Server: 停止插件服务。</li>
<li>Run 运行当前编辑器的脚本。如果有多个设备连接，则在所有设备运行。</li>
<li>Rerun 停止当前文件对应的脚本并重新运行。如果有多个设备连接，则在所有设备重新运行。</li>
<li>Stop 停止当前文件对应的脚本。如果有多个设备连接，则在所有设备停止。</li>
<li>StopAll 停止所有正在运行的脚本。如果有多个设备连接，则在所有设备运行所有脚本。</li>
<li>Save 保存当前文件到手机的脚本默认目录（文件名会加上前缀remote)。如果有多个设备连接，则在所有设备保存。</li>
<li>RunOnDevice: 弹出设备菜单并在指定设备运行脚本。</li>
<li>SaveToDevice: 弹出设备菜单并在指定设备保存脚本。</li>
<li>New Project（新建项目）：选择一个空文件夹（或者在文件管理器中新建一个空文件夹），将会自动创建一个项目</li>
<li>Run Project（运行项目）：运行一个项目，需要Auto.js 4.0.4Alpha5以上支持</li>
<li>Save Project（保存项目）：保存一个项目，需要Auto.js 4.0.4Alpha5以上支持</li>
</ul>
<p>以上命令一些有对应的快捷键，参照命令后面的说明即可。</p>
<h2 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h2><p>要显示来自Auto.js的日志，打开 VS Code上面菜单的”帮助”-&gt;”切换开发人员工具”-&gt;”Console”即可。</p>
<h1 id="钉钉打卡脚本原文"><a href="#钉钉打卡脚本原文" class="headerlink" title="钉钉打卡脚本原文"></a>钉钉打卡脚本原文</h1><h2 id="⏰-DingDing-Automatic-Clock-in"><a href="#⏰-DingDing-Automatic-Clock-in" class="headerlink" title="⏰ DingDing-Automatic-Clock-in"></a>⏰ DingDing-Automatic-Clock-in</h2><img width="796" src="https://user-images.githubusercontent.com/49583943/138620009-32d16b4a-d38b-4cb7-9650-db7f45f14520.png"/>

<h2 id="📖-简介"><a href="#📖-简介" class="headerlink" title="📖 简介"></a>📖 简介</h2><p>钉钉全自动打卡 + 远程打卡脚本，无需 root，基于 auto.js，适用于蓝牙考勤机。</p>
<h2 id="💥-功能"><a href="#💥-功能" class="headerlink" title="💥 功能"></a>💥 功能</h2><ul>
<li>定时打卡</li>
<li>远程打卡</li>
<li>发送考勤结果</li>
</ul>
<h2 id="⚙️-工具"><a href="#⚙️-工具" class="headerlink" title="⚙️ 工具"></a>⚙️ 工具</h2><ul>
<li>auto.js</li>
<li>Tasker</li>
<li>一款通讯应用（示例脚本中使用的是 QQ / 网易邮箱大师 / ServerChan / PushDeer，彼此互为备用方案）</li>
</ul>
<h2 id="💡-原理"><a href="#💡-原理" class="headerlink" title="💡 原理"></a>💡 原理</h2><p>通过 auto.js 脚本监听本机通知，在 Tasker 中创建定时任务，发出通知，或在另一设备上发送消息到本机，即可触发脚本中的打卡进程，实现定时打卡和远程打卡。</p>
<p><img src="https://user-images.githubusercontent.com/49583943/163506300-7ef7693b-a273-442f-8449-dcef31063069.png" alt="image"></p>
<p>同理，监听到钉钉发出的打卡成功通知后，将通知文本通过 QQ消息 或 邮件正文 发送，实现发送考勤结果的功能。</p>
<h2 id="📝-脚本"><a href="#📝-脚本" class="headerlink" title="📝 脚本"></a>📝 脚本</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Author: George Huan</span></span><br><span class="line"><span class="comment"> * @Date: 2020-08-03 09:30:30</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2022-03-26 10:56:25</span></span><br><span class="line"><span class="comment"> * @Description: DingDing-Automatic-Clock-in (Run on AutoJs)</span></span><br><span class="line"><span class="comment"> * @URL: https://github.com/georgehuan1994/DingDing-Automatic-Clock-in</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ACCOUNT = <span class="string">&quot;钉钉账号&quot;</span></span><br><span class="line"><span class="keyword">const</span> PASSWORD = <span class="string">&quot;钉钉密码&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> QQ =              <span class="string">&quot;用于接收打卡结果的QQ号&quot;</span></span><br><span class="line"><span class="keyword">const</span> EMAILL_ADDRESS =  <span class="string">&quot;用于接收打卡结果的邮箱地址&quot;</span></span><br><span class="line"><span class="keyword">const</span> SERVER_CHAN =     <span class="string">&quot;Server酱发送密钥&quot;</span></span><br><span class="line"><span class="keyword">const</span> PUSH_DEER =       <span class="string">&quot;PushDeer发送密钥&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PUSH_METHOD = &#123;<span class="attr">QQ</span>: <span class="number">1</span>, <span class="attr">Email</span>: <span class="number">2</span>, <span class="attr">ServerChan</span>: <span class="number">3</span>, <span class="attr">PushDeer</span>: <span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认通信方式：</span></span><br><span class="line"><span class="comment">// PUSH_METHOD.QQ -- QQ</span></span><br><span class="line"><span class="comment">// PUSH_METHOD.Email -- Email </span></span><br><span class="line"><span class="comment">// PUSH_METHOD.ServerChan -- Server酱</span></span><br><span class="line"><span class="comment">// PUSH_METHOD.PushDeer -- Push Deer</span></span><br><span class="line"><span class="keyword">var</span> DEFAULT_MESSAGE_DELIVER = PUSH_METHOD.QQ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_QQ = <span class="string">&quot;com.tencent.mobileqq&quot;</span>                <span class="comment">// QQ</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_DD = <span class="string">&quot;com.alibaba.android.rimet&quot;</span>           <span class="comment">// 钉钉</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_XMSF = <span class="string">&quot;com.xiaomi.xmsf&quot;</span>                   <span class="comment">// 小米推送服务</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_TASKER = <span class="string">&quot;net.dinglisch.android.taskerm&quot;</span>   <span class="comment">// Tasker</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_MAIL_163 = <span class="string">&quot;com.netease.mail&quot;</span>              <span class="comment">// 网易邮箱大师</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_MAIL_ANDROID = <span class="string">&quot;com.android.email&quot;</span>         <span class="comment">// 系统内置邮箱</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_PUSHDEER = <span class="string">&quot;com.pushdeer.os&quot;</span>               <span class="comment">// Push Deer</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> LOWER_BOUND = <span class="number">1</span> * <span class="number">60</span> * <span class="number">1000</span> <span class="comment">// 最小等待时间：1min</span></span><br><span class="line"><span class="keyword">const</span> UPPER_BOUND = <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span> <span class="comment">// 最大等待时间：5min</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行时的屏幕亮度（0-255）, 需要&quot;修改系统设置&quot;权限</span></span><br><span class="line"><span class="keyword">const</span> SCREEN_BRIGHTNESS = <span class="number">20</span>    </span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否过滤通知</span></span><br><span class="line"><span class="keyword">const</span> NOTIFICATIONS_FILTER = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// PackageId白名单</span></span><br><span class="line"><span class="keyword">const</span> PACKAGE_ID_WHITE_LIST = [PACKAGE_ID_QQ,PACKAGE_ID_DD,PACKAGE_ID_XMSF,PACKAGE_ID_MAIL_163,PACKAGE_ID_TASKER,PACKAGE_ID_PUSHDEER]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 公司的钉钉CorpId, 获取方法见 2020-09-24 更新日志。如果只加入了一家公司, 可以不填</span></span><br><span class="line"><span class="keyword">const</span> CORP_ID = <span class="string">&quot;&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// 锁屏意图, 配合 Tasker 完成锁屏动作, 具体配置方法见 2021-03-09 更新日志</span></span><br><span class="line"><span class="keyword">const</span> ACTION_LOCK_SCREEN = <span class="string">&quot;autojs.intent.action.LOCK_SCREEN&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听音量+键, 开启后无法通过音量+键调整音量, 按下音量+键：结束所有子线程</span></span><br><span class="line"><span class="keyword">const</span> OBSERVE_VOLUME_KEY = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> WEEK_DAY = [<span class="string">&quot;Sunday&quot;</span>,<span class="string">&quot;Monday&quot;</span>,<span class="string">&quot;Tuesday&quot;</span>,<span class="string">&quot;Wednesday&quot;</span>,<span class="string">&quot;Thursday&quot;</span>,<span class="string">&quot;Friday&quot;</span>,<span class="string">&quot;Saturday&quot;</span>,]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// =================== ↓↓↓ 主线程：监听通知 ↓↓↓ ====================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> currentDate = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否暂停定时打卡</span></span><br><span class="line"><span class="keyword">var</span> suspend = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 本次打开钉钉前是否需要等待</span></span><br><span class="line"><span class="keyword">var</span> needWaiting = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行日志路径</span></span><br><span class="line"><span class="keyword">var</span> globalLogFilePath = <span class="string">&quot;/sdcard/脚本/Archive/&quot;</span> + getCurrentDate() + <span class="string">&quot;-log.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查无障碍权限</span></span><br><span class="line">auto.waitFor(<span class="string">&quot;normal&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查Autojs版本</span></span><br><span class="line">requiresAutojsVersion(<span class="string">&quot;4.1.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建运行日志</span></span><br><span class="line"><span class="built_in">console</span>.setGlobalLogConfig(&#123;</span><br><span class="line">    <span class="attr">file</span>: <span class="string">&quot;/sdcard/脚本/Archive/&quot;</span> + getCurrentDate() + <span class="string">&quot;-log.txt&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机通知</span></span><br><span class="line">events.observeNotification()    </span><br><span class="line">events.on(<span class="string">&quot;notification&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    notificationHandler(n)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">events.setKeyInterceptionEnabled(<span class="string">&quot;volume_up&quot;</span>, OBSERVE_VOLUME_KEY)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (OBSERVE_VOLUME_KEY) &#123;</span><br><span class="line">    events.observeKey()</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 监听音量+键</span></span><br><span class="line">events.onKeyDown(<span class="string">&quot;volume_up&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    threads.shutDownAll()</span><br><span class="line">    device.setBrightnessMode(<span class="number">1</span>)</span><br><span class="line">    device.cancelKeepingAwake()</span><br><span class="line">    toast(<span class="string">&quot;已中断所有子线程!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以在此调试各个方法</span></span><br><span class="line">    <span class="comment">// doClock()</span></span><br><span class="line">    <span class="comment">// sendQQMsg(&quot;测试文本&quot;)</span></span><br><span class="line">    <span class="comment">// sendEmail(&quot;测试主题&quot;, &quot;测试文本&quot;, null)</span></span><br><span class="line">    <span class="comment">// sendServerChan(测试主题, 测试文本)</span></span><br><span class="line">    <span class="comment">// sendPushDeer(测试主题, 测试文本)</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">toastLog(<span class="string">&quot;监听中, 请在日志中查看记录的通知及其内容&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// =================== ↑↑↑ 主线程：监听通知 ↑↑↑ =====================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>处理通知</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">notificationHandler</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> packageId = n.getPackageName()  <span class="comment">// 获取通知包名</span></span><br><span class="line">    <span class="keyword">var</span> abstract = n.tickerText         <span class="comment">// 获取通知摘要</span></span><br><span class="line">    <span class="keyword">var</span> text = n.getText()              <span class="comment">// 获取通知文本</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 过滤 PackageId 白名单之外的应用所发出的通知</span></span><br><span class="line">    <span class="keyword">if</span> (!filterNotification(packageId, abstract, text)) &#123; </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听摘要为 &quot;定时打卡&quot; 的通知, 不一定要从 Tasker 中发出通知, 日历、定时器等App均可实现</span></span><br><span class="line">    <span class="keyword">if</span> (abstract == <span class="string">&quot;定时打卡&quot;</span> &amp;&amp; !suspend) &#123; </span><br><span class="line">        needWaiting = <span class="literal">true</span></span><br><span class="line">        threads.shutDownAll()</span><br><span class="line">        threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            doClock()</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(text) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;打卡&quot;</span>: <span class="comment">// 监听文本为 &quot;打卡&quot; 的通知</span></span><br><span class="line">            needWaiting = <span class="literal">false</span></span><br><span class="line">            threads.shutDownAll()</span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                doClock()</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;查询&quot;</span>: <span class="comment">// 监听文本为 &quot;查询&quot; 的通知</span></span><br><span class="line">            threads.shutDownAll()</span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(DEFAULT_MESSAGE_DELIVER) &#123;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.QQ:</span><br><span class="line">                        sendQQMsg(getStorageData(<span class="string">&quot;dingding&quot;</span>, <span class="string">&quot;clockResult&quot;</span>))</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.Email:</span><br><span class="line">                        sendEmail(<span class="string">&quot;考勤结果&quot;</span>, getStorageData(<span class="string">&quot;dingding&quot;</span>, <span class="string">&quot;clockResult&quot;</span>), <span class="literal">null</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.ServerChan:</span><br><span class="line">                        sendServerChan(<span class="string">&quot;考勤结果&quot;</span>, getStorageData(<span class="string">&quot;dingding&quot;</span>, <span class="string">&quot;clockResult&quot;</span>))</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.PushDeer:</span><br><span class="line">                        sendPushDeer(<span class="string">&quot;考勤结果&quot;</span>, getStorageData(<span class="string">&quot;dingding&quot;</span>, <span class="string">&quot;clockResult&quot;</span>))</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;暂停&quot;</span>: <span class="comment">// 监听文本为 &quot;暂停&quot; 的通知</span></span><br><span class="line">            suspend = <span class="literal">true</span></span><br><span class="line">            <span class="built_in">console</span>.warn(<span class="string">&quot;暂停定时打卡&quot;</span>)</span><br><span class="line">            threads.shutDownAll()</span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(DEFAULT_MESSAGE_DELIVER) &#123;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.QQ:</span><br><span class="line">                        sendQQMsg(<span class="string">&quot;修改成功, 已暂停定时打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.Email:</span><br><span class="line">                        sendEmail(<span class="string">&quot;修改成功&quot;</span>, <span class="string">&quot;已暂停定时打卡功能&quot;</span>, <span class="literal">null</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.ServerChan:</span><br><span class="line">                        sendServerChan(<span class="string">&quot;修改成功&quot;</span>, <span class="string">&quot;已暂停定时打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.PushDeer:</span><br><span class="line">                        sendPushDeer(<span class="string">&quot;修改成功&quot;</span>, <span class="string">&quot;已暂停定时打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;恢复&quot;</span>: <span class="comment">// 监听文本为 &quot;恢复&quot; 的通知</span></span><br><span class="line">            suspend = <span class="literal">false</span></span><br><span class="line">            <span class="built_in">console</span>.warn(<span class="string">&quot;恢复定时打卡&quot;</span>)</span><br><span class="line">            threads.shutDownAll()</span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">switch</span>(DEFAULT_MESSAGE_DELIVER) &#123;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.QQ:</span><br><span class="line">                        sendQQMsg(<span class="string">&quot;修改成功, 已恢复定时打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.Email:</span><br><span class="line">                        sendEmail(<span class="string">&quot;修改成功&quot;</span>, <span class="string">&quot;已恢复定时打卡功能&quot;</span>, <span class="literal">null</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.ServerChan:</span><br><span class="line">                        sendServerChan(<span class="string">&quot;修改成功&quot;</span>, <span class="string">&quot;已恢复定时打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> PUSH_METHOD.PushDeer:</span><br><span class="line">                        sendPushDeer(<span class="string">&quot;修改成功&quot;</span>, <span class="string">&quot;已恢复定时打卡功能&quot;</span>)</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;日志&quot;</span>: <span class="comment">// 监听文本为 &quot;日志&quot; 的通知</span></span><br><span class="line">            threads.shutDownAll()</span><br><span class="line">            threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                sendEmail(<span class="string">&quot;获取日志&quot;</span>, globalLogFilePath, globalLogFilePath)</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (text == <span class="literal">null</span>) </span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听钉钉返回的考勤结果</span></span><br><span class="line">    <span class="keyword">if</span> (packageId == PACKAGE_ID_DD &amp;&amp; text.indexOf(<span class="string">&quot;考勤打卡&quot;</span>) &gt;= <span class="number">0</span>) &#123; </span><br><span class="line">        setStorageData(<span class="string">&quot;dingding&quot;</span>, <span class="string">&quot;clockResult&quot;</span>, text)</span><br><span class="line">        threads.shutDownAll()</span><br><span class="line">        threads.start(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span>(DEFAULT_MESSAGE_DELIVER) &#123;</span><br><span class="line">                <span class="keyword">case</span> PUSH_METHOD.QQ:</span><br><span class="line">                    sendQQMsg(text)</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PUSH_METHOD.Email:</span><br><span class="line">                    sendEmail(<span class="string">&quot;考勤结果&quot;</span>, text, cameraFilePath)</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PUSH_METHOD.ServerChan:</span><br><span class="line">                    sendServerChan(<span class="string">&quot;考勤结果&quot;</span>, text)</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PUSH_METHOD.PushDeer:</span><br><span class="line">                    sendPushDeer(<span class="string">&quot;考勤结果&quot;</span>, text)</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>打卡流程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doClock</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    currentDate = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;本地时间: &quot;</span> + getCurrentDate() + <span class="string">&quot; &quot;</span> + getCurrentTime())</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;开始打卡流程!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    brightScreen()      <span class="comment">// 唤醒屏幕</span></span><br><span class="line">    unlockScreen()      <span class="comment">// 解锁屏幕</span></span><br><span class="line">    holdOn()            <span class="comment">// 随机等待</span></span><br><span class="line">    signIn()            <span class="comment">// 自动登录</span></span><br><span class="line">    handleLate()        <span class="comment">// 处理迟到</span></span><br><span class="line">    attendKaoqin()      <span class="comment">// 考勤打卡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (currentDate.getHours() &lt;= <span class="number">12</span>) </span><br><span class="line">    clockIn()           <span class="comment">// 上班打卡</span></span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    clockOut()          <span class="comment">// 下班打卡</span></span><br><span class="line">    </span><br><span class="line">    lockScreen()        <span class="comment">// 关闭屏幕</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>发送邮件流程</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>title 邮件主题</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>message 邮件正文</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>attachFilePath 要发送的附件路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendEmail</span>(<span class="params">title, message, attachFilePath</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;开始发送邮件流程!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    brightScreen()      <span class="comment">// 唤醒屏幕</span></span><br><span class="line">    unlockScreen()      <span class="comment">// 解锁屏幕</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(attachFilePath != <span class="literal">null</span> &amp;&amp; files.exists(attachFilePath)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(attachFilePath)</span><br><span class="line">        app.sendEmail(&#123;</span><br><span class="line">            <span class="attr">email</span>: [EMAILL_ADDRESS], <span class="attr">subject</span>: title, <span class="attr">text</span>: message, <span class="attr">attachment</span>: attachFilePath</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(attachFilePath)</span><br><span class="line">        app.sendEmail(&#123;</span><br><span class="line">            <span class="attr">email</span>: [EMAILL_ADDRESS], <span class="attr">subject</span>: title, <span class="attr">text</span>: message</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;选择邮件应用&quot;</span>)</span><br><span class="line">    waitForActivity(<span class="string">&quot;com.android.internal.app.ChooserActivity&quot;</span>) <span class="comment">// 等待选择应用界面弹窗出现, 如果设置了默认应用就注释掉</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> emailAppName = app.getAppName(PACKAGE_ID_MAIL_163)</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != emailAppName) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != textMatches(emailAppName).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">            btn_email = textMatches(emailAppName).findOnce().parent()</span><br><span class="line">            btn_email.click()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">&quot;不存在应用: &quot;</span> + PACKAGE_ID_MAIL_163)</span><br><span class="line">        lockScreen()</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 网易邮箱大师</span></span><br><span class="line">    <span class="keyword">var</span> versoin = getPackageVersion(PACKAGE_ID_MAIL_163)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;应用版本: &quot;</span> + versoin)</span><br><span class="line">    <span class="keyword">var</span> sp = versoin.split(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> (sp[<span class="number">0</span>] == <span class="number">6</span>) &#123;</span><br><span class="line">        <span class="comment">// 网易邮箱大师 6</span></span><br><span class="line">        waitForActivity(<span class="string">&quot;com.netease.mobimail.activity.MailComposeActivity&quot;</span>)</span><br><span class="line">        id(<span class="string">&quot;send&quot;</span>).findOne().click()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 网易邮箱大师 7</span></span><br><span class="line">        waitForActivity(<span class="string">&quot;com.netease.mobimail.module.mailcompose.MailComposeActivity&quot;</span>)</span><br><span class="line">        <span class="keyword">var</span> input_address = id(<span class="string">&quot;input&quot;</span>).findOne()</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == input_address.getText()) &#123;</span><br><span class="line">            input_address.setText(EMAILL_ADDRESS)</span><br><span class="line">        &#125;</span><br><span class="line">        id(<span class="string">&quot;iv_arrow&quot;</span>).findOne().click()</span><br><span class="line">        sleep(<span class="number">1000</span>)</span><br><span class="line">        id(<span class="string">&quot;img_send_bg&quot;</span>).findOne().click()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 内置电子邮件</span></span><br><span class="line">    <span class="comment">// waitForActivity(&quot;com.kingsoft.mail.compose.ComposeActivity&quot;)</span></span><br><span class="line">    <span class="comment">// id(&quot;compose_send_btn&quot;).findOne().click()</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;正在发送邮件...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    home()</span><br><span class="line">    sleep(<span class="number">2000</span>)</span><br><span class="line">    lockScreen()    <span class="comment">// 关闭屏幕</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>发送QQ消息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>message 消息内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendQQMsg</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;发送QQ消息&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    brightScreen()      <span class="comment">// 唤醒屏幕</span></span><br><span class="line">    unlockScreen()      <span class="comment">// 解锁屏幕</span></span><br><span class="line"></span><br><span class="line">    app.startActivity(&#123; </span><br><span class="line">        <span class="attr">action</span>: <span class="string">&quot;android.intent.action.VIEW&quot;</span>, </span><br><span class="line">        <span class="attr">data</span>:<span class="string">&quot;mqq://im/chat?chat_type=wpa&amp;version=1&amp;src_type=web&amp;uin=&quot;</span> + QQ, </span><br><span class="line">        <span class="attr">packageName</span>: <span class="string">&quot;com.tencent.mobileqq&quot;</span>, </span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// waitForActivity(&quot;com.tencent.mobileqq.activity.SplashActivity&quot;)</span></span><br><span class="line"></span><br><span class="line">    id(<span class="string">&quot;input&quot;</span>).findOne().setText(message)</span><br><span class="line">    id(<span class="string">&quot;fun_btn&quot;</span>).findOne().click()</span><br><span class="line"></span><br><span class="line">    home()</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">    lockScreen()    <span class="comment">// 关闭屏幕</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>ServerChan推送</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>title 标题</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>message 消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">sendServerChan</span>(<span class="params">title, message</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;向 ServerChan 发起推送请求&quot;</span>)</span><br><span class="line"></span><br><span class="line">    url = <span class="string">&quot;https://sctapi.ftqq.com/&quot;</span> + SERVER_CHAN + <span class="string">&quot;.send&quot;</span>;</span><br><span class="line"></span><br><span class="line">    res = http.post(<span class="built_in">encodeURI</span>(url), &#123;</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: title,</span><br><span class="line">        <span class="string">&quot;desp&quot;</span>: message</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">    lockScreen()    <span class="comment">// 关闭屏幕</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>PushDeer推送</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>title 标题</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>message 消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">sendPushDeer</span>(<span class="params">title, message</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;向 PushDeer 发起推送请求&quot;</span>)</span><br><span class="line"></span><br><span class="line">    url = <span class="string">&quot;https://api2.pushdeer.com/message/push&quot;</span></span><br><span class="line"></span><br><span class="line">    res = http.post(<span class="built_in">encodeURI</span>(url), &#123;</span><br><span class="line">        <span class="string">&quot;pushkey&quot;</span>: PUSH_DEER,</span><br><span class="line">        <span class="string">&quot;text&quot;</span>: title,</span><br><span class="line">        <span class="string">&quot;desp&quot;</span>: message,</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;markdown&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">    lockScreen()    <span class="comment">// 关闭屏幕</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>唤醒设备</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">brightScreen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;唤醒设备&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    device.setBrightnessMode(<span class="number">0</span>) <span class="comment">// 手动亮度模式</span></span><br><span class="line">    device.setBrightness(SCREEN_BRIGHTNESS)</span><br><span class="line">    device.wakeUpIfNeeded() <span class="comment">// 唤醒设备</span></span><br><span class="line">    device.keepScreenOn()   <span class="comment">// 保持亮屏</span></span><br><span class="line">    sleep(<span class="number">1000</span>) <span class="comment">// 等待屏幕亮起</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!device.isScreenOn()) &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;设备未唤醒, 重试&quot;</span>)</span><br><span class="line">        device.wakeUpIfNeeded()</span><br><span class="line">        brightScreen()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(<span class="string">&quot;设备已唤醒&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>解锁屏幕</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unlockScreen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;解锁屏幕&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (isDeviceLocked()) &#123;</span><br><span class="line"></span><br><span class="line">        gesture(</span><br><span class="line">            <span class="number">320</span>, <span class="comment">// 滑动时间：毫秒</span></span><br><span class="line">            [</span><br><span class="line">                device.width  * <span class="number">0.5</span>,    <span class="comment">// 滑动起点 x 坐标：屏幕宽度的一半</span></span><br><span class="line">                device.height * <span class="number">0.9</span>     <span class="comment">// 滑动起点 y 坐标：距离屏幕底部 10% 的位置, 华为系统需要往上一些</span></span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">                device.width / <span class="number">2</span>,       <span class="comment">// 滑动终点 x 坐标：屏幕宽度的一半</span></span><br><span class="line">                device.height * <span class="number">0.1</span>     <span class="comment">// 滑动终点 y 坐标：距离屏幕顶部 10% 的位置</span></span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">1000</span>) <span class="comment">// 等待解锁动画完成</span></span><br><span class="line">        home()</span><br><span class="line">        sleep(<span class="number">1000</span>) <span class="comment">// 等待返回动画完成</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isDeviceLocked()) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">&quot;上滑解锁失败, 请按脚本中的注释调整 gesture(time, [x1,y1], [x2,y2]) 方法的参数!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">&quot;屏幕已解锁&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>随机等待</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">holdOn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!needWaiting) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> randomTime = random(LOWER_BOUND, UPPER_BOUND)</span><br><span class="line">    toastLog(<span class="built_in">Math</span>.floor(randomTime / <span class="number">1000</span>) + <span class="string">&quot;秒后启动&quot;</span> + app.getAppName(PACKAGE_ID_DD) + <span class="string">&quot;...&quot;</span>)</span><br><span class="line">    sleep(randomTime)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>启动并登陆钉钉</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">signIn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    app.launchPackage(PACKAGE_ID_DD)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;正在启动&quot;</span> + app.getAppName(PACKAGE_ID_DD) + <span class="string">&quot;...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    setVolume(<span class="number">0</span>) <span class="comment">// 设备静音</span></span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">10000</span>) <span class="comment">// 等待钉钉启动</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (currentPackage() == PACKAGE_ID_DD &amp;&amp;</span><br><span class="line">        currentActivity() == <span class="string">&quot;com.alibaba.android.user.login.SignUpWithPwdActivity&quot;</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(<span class="string">&quot;账号未登录&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> account = id(<span class="string">&quot;et_phone_input&quot;</span>).findOne()</span><br><span class="line">        account.setText(ACCOUNT)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;输入账号&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> password = id(<span class="string">&quot;et_pwd_login&quot;</span>).findOne()</span><br><span class="line">        password.setText(PASSWORD)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;输入密码&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> privacy = id(<span class="string">&quot;cb_privacy&quot;</span>).findOne()</span><br><span class="line">        privacy.click()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;同意隐私协议&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> btn_login = id(<span class="string">&quot;btn_next&quot;</span>).findOne()</span><br><span class="line">        btn_login.click()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;正在登陆...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">3000</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (currentPackage() == PACKAGE_ID_DD &amp;&amp;</span><br><span class="line">        currentActivity() != <span class="string">&quot;com.alibaba.android.user.login.SignUpWithPwdActivity&quot;</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(<span class="string">&quot;账号已登录&quot;</span>)</span><br><span class="line">        sleep(<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>处理迟到打卡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleLate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textMatches(<span class="string">&quot;迟到打卡&quot;</span>).clickable(<span class="literal">true</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        btn_late = textMatches(<span class="string">&quot;迟到打卡&quot;</span>).clickable(<span class="literal">true</span>).findOnce() </span><br><span class="line">        btn_late.click()</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;迟到打卡&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != descMatches(<span class="string">&quot;迟到打卡&quot;</span>).clickable(<span class="literal">true</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        btn_late = descMatches(<span class="string">&quot;迟到打卡&quot;</span>).clickable(<span class="literal">true</span>).findOnce() </span><br><span class="line">        btn_late.click()</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;迟到打卡&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>使用 URL Scheme 进入考勤界面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">attendKaoqin</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> url_scheme = <span class="string">&quot;dingtalk://dingtalkclient/page/link?url=https://attend.dingtalk.com/attend/index.html&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(CORP_ID != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        url_scheme = url_scheme + <span class="string">&quot;?corpId=&quot;</span> + CORP_ID</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a = app.intent(&#123;</span><br><span class="line">        <span class="attr">action</span>: <span class="string">&quot;VIEW&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: url_scheme,</span><br><span class="line">        <span class="comment">//flags: [Intent.FLAG_ACTIVITY_NEW_TASK]</span></span><br><span class="line">    &#125;);</span><br><span class="line">    app.startActivity(a);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;正在进入考勤界面...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    textContains(<span class="string">&quot;申请&quot;</span>).waitFor()</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">&quot;已进入考勤界面&quot;</span>)</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>上班打卡 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clockIn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;上班打卡...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textContains(<span class="string">&quot;已打卡&quot;</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(<span class="string">&quot;已打卡&quot;</span>)</span><br><span class="line">        toast(<span class="string">&quot;已打卡&quot;</span>)</span><br><span class="line">        home()</span><br><span class="line">        sleep(<span class="number">1000</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;等待连接到考勤机...&quot;</span>)</span><br><span class="line">    sleep(<span class="number">2000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textContains(<span class="string">&quot;未连接&quot;</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">&quot;未连接考勤机, 重新进入考勤界面!&quot;</span>)</span><br><span class="line">        back()</span><br><span class="line">        sleep(<span class="number">2000</span>)</span><br><span class="line">        attendKaoqin()</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    textContains(<span class="string">&quot;已连接&quot;</span>).waitFor()</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">&quot;已连接考勤机&quot;</span>)</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textMatches(<span class="string">&quot;上班打卡&quot;</span>).clickable(<span class="literal">true</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        btn_clockin = textMatches(<span class="string">&quot;上班打卡&quot;</span>).clickable(<span class="literal">true</span>).findOnce()</span><br><span class="line">        btn_clockin.click()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;按下打卡按钮&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        click(device.width / <span class="number">2</span>, device.height * <span class="number">0.560</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;点击打卡按钮坐标&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">    handleLate() <span class="comment">// 处理迟到打卡</span></span><br><span class="line">    </span><br><span class="line">    home()</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>下班打卡 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clockOut</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;下班打卡...&quot;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;等待连接到考勤机...&quot;</span>)</span><br><span class="line">    sleep(<span class="number">2000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textContains(<span class="string">&quot;未连接&quot;</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">&quot;未连接考勤机, 重新进入考勤界面!&quot;</span>)</span><br><span class="line">        back()</span><br><span class="line">        sleep(<span class="number">2000</span>)</span><br><span class="line">        attendKaoqin()</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    textContains(<span class="string">&quot;已连接&quot;</span>).waitFor()</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">&quot;已连接考勤机&quot;</span>)</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textMatches(<span class="string">&quot;下班打卡&quot;</span>).clickable(<span class="literal">true</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        btn_clockout = textMatches(<span class="string">&quot;下班打卡&quot;</span>).clickable(<span class="literal">true</span>).findOnce()</span><br><span class="line">        btn_clockout.click()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;按下打卡按钮&quot;</span>)</span><br><span class="line">        sleep(<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        click(device.width / <span class="number">2</span>, device.height * <span class="number">0.560</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;点击打卡按钮坐标&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != textContains(<span class="string">&quot;早退打卡&quot;</span>).clickable(<span class="literal">true</span>).findOne(<span class="number">1000</span>)) &#123;</span><br><span class="line">        className(<span class="string">&quot;android.widget.Button&quot;</span>).text(<span class="string">&quot;早退打卡&quot;</span>).clickable(<span class="literal">true</span>).findOnce().parent().click()</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&quot;早退打卡&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    home()</span><br><span class="line">    sleep(<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>锁屏</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lockScreen</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;关闭屏幕&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 锁屏方案1：Root</span></span><br><span class="line">    <span class="comment">// Power()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 锁屏方案2：No Root</span></span><br><span class="line">    <span class="comment">// press(Math.floor(device.width / 2), Math.floor(device.height * 0.973), 1000) // 小米的快捷手势：长按Home键锁屏</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 万能锁屏方案：向Tasker发送广播, 触发系统锁屏动作。配置方法见 2021-03-09 更新日志</span></span><br><span class="line">    app.sendBroadcast(&#123;<span class="attr">action</span>: ACTION_LOCK_SCREEN&#125;);</span><br><span class="line"></span><br><span class="line">    device.setBrightnessMode(<span class="number">1</span>) <span class="comment">// 自动亮度模式</span></span><br><span class="line">    device.cancelKeepingAwake() <span class="comment">// 取消设备常亮</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (isDeviceLocked()) &#123;</span><br><span class="line">        <span class="built_in">console</span>.info(<span class="string">&quot;屏幕已关闭&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">&quot;屏幕未关闭, 请尝试其他锁屏方案, 或等待屏幕自动关闭&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ===================== ↓↓↓ 功能函数 ↓↓↓ =======================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dateDigitToString</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num &lt; <span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span> + num : num</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentTime</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> currentDate = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    <span class="keyword">var</span> hours = dateDigitToString(currentDate.getHours())</span><br><span class="line">    <span class="keyword">var</span> minute = dateDigitToString(currentDate.getMinutes())</span><br><span class="line">    <span class="keyword">var</span> second = dateDigitToString(currentDate.getSeconds())</span><br><span class="line">    <span class="keyword">var</span> formattedTimeString = hours + <span class="string">&#x27;:&#x27;</span> + minute + <span class="string">&#x27;:&#x27;</span> + second</span><br><span class="line">    <span class="keyword">return</span> formattedTimeString</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentDate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> currentDate = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    <span class="keyword">var</span> year = dateDigitToString(currentDate.getFullYear())</span><br><span class="line">    <span class="keyword">var</span> month = dateDigitToString(currentDate.getMonth() + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">var</span> date = dateDigitToString(currentDate.getDate())</span><br><span class="line">    <span class="keyword">var</span> week = currentDate.getDay()</span><br><span class="line">    <span class="keyword">var</span> formattedDateString = year + <span class="string">&#x27;-&#x27;</span> + month + <span class="string">&#x27;-&#x27;</span> + date + <span class="string">&#x27;-&#x27;</span> + WEEK_DAY[week]</span><br><span class="line">    <span class="keyword">return</span> formattedDateString</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通知过滤器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterNotification</span>(<span class="params">bundleId, abstract, text</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> check = PACKAGE_ID_WHITE_LIST.some(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;<span class="keyword">return</span> bundleId == item&#125;) </span><br><span class="line">    <span class="keyword">if</span> (!NOTIFICATIONS_FILTER || check) &#123;</span><br><span class="line">        <span class="built_in">console</span>.verbose(bundleId)</span><br><span class="line">        <span class="built_in">console</span>.verbose(abstract)</span><br><span class="line">        <span class="built_in">console</span>.verbose(text)</span><br><span class="line">        <span class="built_in">console</span>.verbose(<span class="string">&quot;---------------------------&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存本地数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setStorageData</span>(<span class="params">name, key, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> storage = storages.create(name)  <span class="comment">// 创建storage对象</span></span><br><span class="line">    storage.put(key, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取本地数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getStorageData</span>(<span class="params">name, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> storage = storages.create(name)</span><br><span class="line">    <span class="keyword">if</span> (storage.contains(key)) &#123;</span><br><span class="line">        <span class="keyword">return</span> storage.get(key, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 默认返回undefined</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除本地数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delStorageData</span>(<span class="params">name, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> storage = storages.create(name)</span><br><span class="line">    <span class="keyword">if</span> (storage.contains(key)) &#123;</span><br><span class="line">        storage.remove(key)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取应用版本号</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPackageVersion</span>(<span class="params">bundleId</span>) </span>&#123;</span><br><span class="line">    importPackage(android.content)</span><br><span class="line">    <span class="keyword">var</span> pckMan = context.getPackageManager()</span><br><span class="line">    <span class="keyword">var</span> packageInfo = pckMan.getPackageInfo(bundleId, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> packageInfo.versionName</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 屏幕是否为锁定状态</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isDeviceLocked</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    importClass(android.app.KeyguardManager)</span><br><span class="line">    importClass(android.content.Context)</span><br><span class="line">    <span class="keyword">var</span> km = context.getSystemService(Context.KEYGUARD_SERVICE)</span><br><span class="line">    <span class="keyword">return</span> km.isKeyguardLocked()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置媒体和通知音量</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setVolume</span>(<span class="params">volume</span>) </span>&#123;</span><br><span class="line">    device.setMusicVolume(volume)</span><br><span class="line">    device.setNotificationVolume(volume)</span><br><span class="line">    <span class="built_in">console</span>.verbose(<span class="string">&quot;媒体音量:&quot;</span> + device.getMusicVolume())</span><br><span class="line">    <span class="built_in">console</span>.verbose(<span class="string">&quot;通知音量:&quot;</span> + device.getNotificationVolume())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="📐-工具介绍"><a href="#📐-工具介绍" class="headerlink" title="📐 工具介绍"></a>📐 工具介绍</h2><h3 id="Auto-js"><a href="#Auto-js" class="headerlink" title="Auto.js"></a>Auto.js</h3><p>Auto.js 是利用安卓系统的 「无障碍服务」 实现类似于按键精灵一样，可以通过代码模拟一系列界面动作的辅助工具。</p>
<p>与 「按键精灵」 不同的是，它的模拟动作并不是简单的使用在界面定坐标点来实现，而是找控件来实现的。</p>
<p>免费版：<a target="_blank" rel="noopener" href="https://github.com/georgehuan1994/DingDing-Automatic-Clock-in/raw/master/Autojs%204.1.1a%20Alpha2-armeabi-v7a-release.apk" title="Auto.js 4.1.1a Alpha2-armeabi-v7a-release">Auto.js 4.1.1a Alpha2-armeabi-v7a-release</a></p>
<p>github：<a target="_blank" rel="noopener" href="https://github.com/hyb1996/Auto.js">GitHub - hyb1996/Auto.js</a></p>
<p>官方文档：<a target="_blank" rel="noopener" href="https://hyb1996.github.io/AutoJs-Docs/">首页 - Auto.js</a></p>
<p>推荐使用<a target="_blank" rel="noopener" href="https://github.com/hyb1996/Auto.js-VSCode-Extension">VS Code 插件</a>进行调试，调试完成后，还能通过此插件将脚本保存到手机上。</p>
<h3 id="Tasker"><a href="#Tasker" class="headerlink" title="Tasker"></a>Tasker</h3><p><a target="_blank" rel="noopener" href="https://play.google.com/store/apps/details?id=net.dinglisch.android.taskerm">Tasker</a> 也是一个安卓自动化神器，与 Auto.js 结合使用可胜任日常工作流。</p>
<p>此处仅提供 Tasker 5.0 及以下的官方原版，原版不含正版验证，使用不受限制：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/georgehuan1994/DingDing-Automatic-Clock-in/blob/master/Tasker.4.9u4m.apk">Tasker.4.9u4m.apk</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/georgehuan1994/DingDing-Automatic-Clock-in/blob/master/Tasker.5.0u7m.apk">Tasker.5.0u7m.apk</a></p>
<p>Tasker 定时打卡配置：</p>
<ol>
<li>添加一个 「通知」 操作任务，通知标题修改为 「定时打卡」，通知文字随意，通知优先级设为 1。</li>
<li>添加两个配置文件，使用日期和时间作为条件，分别在上班前和下班后触发。</li>
</ol>
<p>你也可以<a target="_blank" rel="noopener" href="https://github.com/georgehuan1994/DingDing-Automatic-Clock-in/tree/master/Tasker%E9%85%8D%E7%BD%AE">下载配置文件</a>，导入到 Tasker 中使用，方法如下：</p>
<ol>
<li>长按 菜单栏-任务，导入”发送通知.tsk.xml”。</li>
<li>长按 菜单栏-配置文件，导入”上班打卡.prf.xml” 和 “下班打卡.prf.xml”。</li>
<li>在任务编辑界面左下方有一个三角形的播放按钮，点击即可发送通知，方便调试。</li>
</ol>
<h2 id="🕹️-使用方法"><a href="#🕹️-使用方法" class="headerlink" title="🕹️ 使用方法"></a>🕹️ 使用方法</h2><h3 id="远程打卡"><a href="#远程打卡" class="headerlink" title="远程打卡"></a>远程打卡</h3><ul>
<li>向本机的 QQ 发送消息 「打卡」，或回复标题为 「打卡」 的邮件，或向 PushDeer 发送标题为「打卡」 的推送请求，即可触发打卡进程。</li>
<li>向本机的 QQ 发送消息 「查询」，或回复标题为 「查询」 的邮件，或向 PushDeer 发送标题为「查询」 的推送请求，即可查询最新一次打卡结果。</li>
</ul>
<h3 id="暂停-恢复定时打卡"><a href="#暂停-恢复定时打卡" class="headerlink" title="暂停/恢复定时打卡"></a>暂停/恢复定时打卡</h3><ul>
<li>向本机的 QQ 发送消息 「暂停」，或回复标题为 「暂停」 的邮件，或向 PushDeer 发送标题为「暂停」 的推送请求，即可暂停定时打卡功能（仅暂停定时打卡，不影响远程打卡功能）</li>
<li>向本机的 QQ 发送消息 「恢复」，或回复标题为 「恢复」 的邮件，或向 PushDeer 发送标题为「恢复」 的推送请求，即可恢复定时打卡功能。</li>
</ul>
<h2 id="⚠️-注意事项-必读"><a href="#⚠️-注意事项-必读" class="headerlink" title="⚠️ 注意事项 (必读!!!)"></a>⚠️ 注意事项 (必读!!!)</h2><ul>
<li>AutoJs Pro 版本屏蔽了一些主流应用，如果要使用 QQ 作为回复方式，不要使用 AutoJs Pro 版！</li>
<li>首次启动 AutoJs，需要为其开启无障碍权限。</li>
<li>运行脚本前，请在 AutoJs 菜单栏中（从屏幕左边划出），开启 「通知读取权限」。</li>
<li>若无法通过 <code>app.launchPackage()</code> 方法启动应用，请开启该应用的「自启动」「允许后台弹窗」。</li>
<li>AutoJs、Tasker 可息屏运行，需要在系统设置中开启通知亮屏。</li>
<li>为保证 AutoJs、Tasker 进程不被系统清理，可调整它们的电池管理策略、加入管理应用的白名单，为其开启前台服务、添加应用锁…</li>
<li>虽然脚本可执行完整的打卡步骤，但推荐开启钉钉的极速打卡功能，在钉钉启动时即可完成打卡，应把后续的步骤视为极速打卡失败后的保险措施。</li>
</ul>
<h2 id="📜-更新日志"><a href="#📜-更新日志" class="headerlink" title="📜 更新日志"></a>📜 更新日志</h2><h3 id="2022-03-26"><a href="#2022-03-26" class="headerlink" title="2022-03-26"></a>2022-03-26</h3><details open>
<summary></summary>

<ol>
<li>可以通过 PushDeer 接收通知、推送考勤结果</details></li>
</ol>
<h3 id="2022-03-01"><a href="#2022-03-01" class="headerlink" title="2022-03-01"></a>2022-03-01</h3><details open>
<summary></summary>

<ol>
<li>可以通过Server酱来推送考勤结果</details></li>
</ol>
<h3 id="2021-10-23"><a href="#2021-10-23" class="headerlink" title="2021-10-23"></a>2021-10-23</h3><details open>
<summary></summary>

<ol>
<li>适配网易邮箱大师7.0</details></li>
</ol>
<h3 id="2021-09-02"><a href="#2021-09-02" class="headerlink" title="2021-09-02"></a>2021-09-02</h3><details open>
<summary></summary>

<ol>
<li>新增获取日志功能，发送 「日志」，可将运行日志作为邮件附件发送（最好使用内置邮件）</li>
<li>优化通知过滤器，过滤 Tasker 发出的无效通知</details></li>
</ol>
<h3 id="2021-07-07"><a href="#2021-07-07" class="headerlink" title="2021-07-07"></a>2021-07-07</h3><details open>
<summary></summary>

<ol>
<li>登录流程自动同意隐私协议</details></li>
</ol>
<h3 id="2021-05-27"><a href="#2021-05-27" class="headerlink" title="2021-05-27"></a>2021-05-27</h3><details open>
<summary></summary>

<ol>
<li>修改了部分常量的命名</li>
<li>移除了休息日不打卡的判断</li>
<li>在邮件的基础上，增加QQ作为新的通讯方式。除发送考勤结果需要手动指定应用外，使用QQ向本机发送 「查询、暂停、恢复」 指令，则会用QQ来回复查询或操作结果；使用邮件向本机发送指令则用邮件回复。</details></li>
</ol>
<h3 id="2021-05-06"><a href="#2021-05-06" class="headerlink" title="2021-05-06"></a>2021-05-06</h3><details open>
<summary></summary>

<ol>
<li>增加音量上键监听，按下后中断所有子线程，也可以利用回调来进行调试</li>
<li>不再使用考勤机名称来判断连接状态</li>
<li>重新进入打卡界面前，先返回上级菜单，以解决顶号登录无法正常连接到考勤机的问题</li>
<li>启动钉钉时，将媒体音量和通知音量设为0</details></li>
</ol>
<h3 id="2021-03-15"><a href="#2021-03-15" class="headerlink" title="2021-03-15"></a>2021-03-15</h3><details open>
<summary></summary>

<ol>
<li>运行时检查Auto.js版本，脚本需要在Auto.js 4.1.0及以上版本中运行</li>
<li>新增解锁是否成功的判断，若解锁失败则停止运行脚本</li>
<li>优化 <code>signIn()</code> 方法，使用 bundleId + activity 来判断登录情况</li>
<li>优化部分控件和信息的获取方式</details></li>
</ol>
<h3 id="2021-03-09"><a href="#2021-03-09" class="headerlink" title="2021-03-09"></a>2021-03-09</h3><details open>
<summary></summary>

<ol>
<li><p>移除 「结束钉钉」、「检查更新」 这个两个过程，使用最近一次监测到的正在运行的应用的包名进行判断</p>
</li>
<li><p>补充一个万能锁屏方案：向Tasker发送广播，触发Tasker中的系统锁屏操作。</p>
<ul>
<li>在Tasker中添加一个任务，在任务中添加操作 「系统锁屏（关闭屏幕）」</li>
<li>在Tasker中添加一个事件类型的配置文件，事件类别：系统-收到的意图</li>
<li>在事件操作中填写：autojs.intent.action.LOCK_SCREEN ，保持发送方与接收方的action一致即可</li>
</ul>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.sendBroadcast(&#123;</span><br><span class="line">        <span class="attr">action</span>: <span class="string">&#x27;autojs.intent.action.LOCK_SCREEN&#x27;</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
</details>

<h3 id="2021-02-07"><a href="#2021-02-07" class="headerlink" title="2021-02-07"></a>2021-02-07</h3><details open>
<summary></summary>

<ol>
<li>防止监听事件被耗时操作阻塞。</details></li>
</ol>
<h3 id="2021-01-15"><a href="#2021-01-15" class="headerlink" title="2021-01-15"></a>2021-01-15</h3><details open>
<summary></summary> 

<ol>
<li>移除 「进入工作台」 以及 「进入考勤打卡界面」 这两个过程</li>
<li>启动并成功登录钉钉后，直接使用intent拉起考勤打卡界面</details></li>
</ol>
<h3 id="2021-01-08"><a href="#2021-01-08" class="headerlink" title="2021-01-08"></a>2021-01-08</h3><details open>
<summary></summary>

<ol>
<li>修复：通知过滤器报错</details></li>
</ol>
<h3 id="2020-12-30"><a href="#2020-12-30" class="headerlink" title="2020-12-30"></a>2020-12-30</h3><details open>
<summary></summary>

<ol>
<li>优化：现在可以通过邮件来 暂停/恢复 定时打卡功能，以应对停工停产，或其他需要暂时停止定时打卡的特殊情况</details></li>
</ol>
<h3 id="2020-12-04"><a href="#2020-12-04" class="headerlink" title="2020-12-04"></a>2020-12-04</h3><details open>
<summary></summary>

<ol>
<li>优化：打卡过程在子线程中执行，钉钉返回打卡结果后，直接中断子线程，减少无效操作</details></li>
</ol>
<h3 id="2020-10-27"><a href="#2020-10-27" class="headerlink" title="2020-10-27"></a>2020-10-27</h3><details open>
<summary></summary>

<ol>
<li>修复：当钉钉的通知文本为null时，indexOf()方法无法正常执行</details></li>
</ol>
<h3 id="2020-09-24"><a href="#2020-09-24" class="headerlink" title="2020-09-24"></a>2020-09-24</h3><details open>
<summary></summary>

<ol>
<li>优化：使用URL Scheme直接拉起考勤打卡界面</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">attendKaoqin</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = app.intent(&#123;</span><br><span class="line">        <span class="attr">action</span>: <span class="string">&quot;VIEW&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="string">&quot;dingtalk://dingtalkclient/page/link?url=https://attend.dingtalk.com/attend/index.html&quot;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      app.startActivity(a);</span><br><span class="line">      sleep(<span class="number">5000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="获取URL的方式如下："><a href="#获取URL的方式如下：" class="headerlink" title="获取URL的方式如下："></a>获取URL的方式如下：</h4><ol>
<li>在PC端找到 「智能工作助理」 联系人</li>
<li>发送消息 “打卡” ，点击 「立即打卡」 </li>
<li>弹出一个二维码。此二维码就是拉起考勤打卡界面的 URL，用自带的相机或其他应用扫描，并在浏览器中打开，即可获得完整URL</li>
<li>观察获取到的URL，找到 <code>CorpId=xxxxxxxxxxxxxxxxxxx</code> ，将CorpId的值填写到的脚本开头的CORP_ID这个常量中</li>
<li>仅使用 <code>dingtalk://dingtalkclient/page/link?url=https://attend.dingtalk.com/attend/index.html</code>，也可以拉起旧版打卡界面，钉钉会自动获取企业的CorpId。如果加入了多个组织，且没有填写CorpId，则在拉起考勤界面时会弹出一个选择组织的对话框。</details></li>
</ol>
<h3 id="2020-09-11"><a href="#2020-09-11" class="headerlink" title="2020-09-11"></a>2020-09-11</h3><details open>
<summary></summary>

<ol>
<li>将上次考勤结果储存在本地</li>
<li>将运行日志储存在本地 /sdcard/脚本/Archive/</li>
<li>修复在下班极速打卡之后，重复打卡的问题</details></li>
</ol>
<h3 id="2020-09-04"><a href="#2020-09-04" class="headerlink" title="2020-09-04"></a>2020-09-04</h3><details open>
<summary></summary>

<ol>
<li>将 “打卡” 与 “发送邮件” 分离成两个过程，打卡完成后，将钉钉返回的考勤结果作为邮件正文发送</details open></li>
</ol>
<h3 id="2020-09-02"><a href="#2020-09-02" class="headerlink" title="2020-09-02"></a>2020-09-02</h3><details open>
<summary></summary>

<ol>
<li>改为使用 “去打卡” 文本获取按钮。若找不到 “去打卡” 按钮，则直接点击 “考勤打卡” 的屏幕坐标</details></li>
</ol>
<h2 id="📢-声明"><a href="#📢-声明" class="headerlink" title="📢 声明"></a>📢 声明</h2><p>此仓库及脚本仅供学习交流，欢迎转载。旨在让人们关注996制度的存在和非法性，并尝试改变这种现象。</p>
<p>根据1994年第八届全国人大常委会通过和2018年第十三届全国人大常委会修正的《中华人民共和国劳动法》规定，劳动者<strong>每日工作时间不超过8小时，平均每周工作时间不超过44小时，而996工作制每周至少要工作72个小时</strong>，远超法律标准，因此996工作制度违反劳动法。</p>
<p><font color=red>而钉钉却允许企业管理者违反法律，非法排班！</font> </p>
<blockquote>

<p><strong>第三十六条</strong>　国家实行劳动者每日工作时间不超过八小时、平均每周工作时间不超过四十四小时的工时制度。</p>
<p><strong>第四十一条</strong>　用人单位由于生产经营需要，经与工会和劳动者协商后可以延长工作时间，一般每日不得超过一小时；因特殊原因需要延长工作时间的，在保障劳动者身体健康的条件下延长工作时间每日不得超过三小时，但是每月不得超过三十六小时。</p>
<p><strong>第四十四条</strong>　有下列情形之一的，用人单位应当按照下列标准支付高于劳动者正常工作时间工资的工资报酬：</p>
<p>（一）安排劳动者延长工作时间的，支付不低于工资的百分之一百五十的工资报酬；<br>（二）休息日安排劳动者工作又不能安排补休的，支付不低于工资的百分之二百的工资报酬；<br>（三）法定休假日安排劳动者工作的，支付不低于工资的百分之三百的工资报酬。  </p>
<p><strong>第九十条</strong>　用人单位违反本法规定，延长劳动者工作时间的，由劳动行政部门给予警告，责令改正，并可以处以罚款。</p>
<p><strong>第九十一条</strong>　用人单位有下列侵害劳动者合法权益情形之一的，由劳动行政部门责令支付劳动者的工资报酬、经济补偿，并可以责令支付赔偿金：</p>
<p>（二）拒不支付劳动者延长工作时间工资报酬的；</p>
</blockquote>

<p>相关项目：<a target="_blank" rel="noopener" href="https://github.com/georgehuan1994/996-Salary-Calculator">996 薪资计算助手</a></p>
<hr>
<pre><code>如果觉得还不错的话，就点击右上角, 给我个Star ⭐️ 鼓励一下我吧~
</code></pre>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">ZJH</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/09/16/脚本/DingDing-Automatic-Clock-in-master/DingDing-Automatic-Clock-in/">http://example.com/2022/09/16/脚本/DingDing-Automatic-Clock-in-master/DingDing-Automatic-Clock-in/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com">Zany's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/autojs/">autojs</a><a class="post-meta__tags" href="/tags/%E9%92%89%E9%92%89/">钉钉</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2022/09/02/%E9%83%A8%E7%BD%B2%E6%89%8B%E5%86%8C/"><span>hexo 部署手册</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By ZJH</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>