<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="卷积神经网络实现图片验证码"><meta name="keywords" content="神经网络,cnn"><meta name="author" content="ZJH"><meta name="copyright" content="ZJH"><title>卷积神经网络实现图片验证码 | Zany's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#cnn-captcha"><span class="toc-number">1.</span> <span class="toc-text">cnn_captcha</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E8%A1%A8"><span class="toc-number">2.</span> <span class="toc-text">时间表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2018-11-12"><span class="toc-number">2.0.0.1.</span> <span class="toc-text">2018.11.12</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2018-11-21"><span class="toc-number">2.0.0.2.</span> <span class="toc-text">2018.11.21</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2018-11-24"><span class="toc-number">2.0.0.3.</span> <span class="toc-text">2018.11.24</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2018-11-26"><span class="toc-number">2.0.0.4.</span> <span class="toc-text">2018.11.26</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2018-12-06"><span class="toc-number">2.0.0.5.</span> <span class="toc-text">2018.12.06</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2018-12-08"><span class="toc-number">2.0.0.6.</span> <span class="toc-text">2018.12.08</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2019-02-19"><span class="toc-number">2.0.0.7.</span> <span class="toc-text">2019.02.19</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2019-04-12"><span class="toc-number">2.0.0.8.</span> <span class="toc-text">2019.04.12</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2019-06-01"><span class="toc-number">2.0.0.9.</span> <span class="toc-text">2019.06.01</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">3.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.</span> <span class="toc-text">1 项目介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%85%B3%E4%BA%8E%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB"><span class="toc-number">4.1.</span> <span class="toc-text">1.1 关于验证码识别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.</span> <span class="toc-text">1.2 目录结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.1.</span> <span class="toc-text">1.2.1 基本配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.2.2.</span> <span class="toc-text">1.2.2 训练模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-web%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.2.3.</span> <span class="toc-text">1.2.3 web接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E4%BE%9D%E8%B5%96"><span class="toc-number">4.3.</span> <span class="toc-text">1.3 依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%84"><span class="toc-number">4.4.</span> <span class="toc-text">1.4 模型结构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">2 如何使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">5.1.</span> <span class="toc-text">2.1 数据集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.2.</span> <span class="toc-text">2.2 配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E9%AA%8C%E8%AF%81%E5%92%8C%E6%8B%86%E5%88%86%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">5.3.</span> <span class="toc-text">2.3 验证和拆分数据集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.4.</span> <span class="toc-text">2.4 训练模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E6%89%B9%E9%87%8F%E9%AA%8C%E8%AF%81"><span class="toc-number">5.5.</span> <span class="toc-text">2.5 批量验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E5%90%AF%E5%8A%A8WebServer"><span class="toc-number">5.6.</span> <span class="toc-text">2.6 启动WebServer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3%E8%AF%86%E5%88%AB"><span class="toc-number">5.7.</span> <span class="toc-text">2.7 调用接口识别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-8-%E9%83%A8%E7%BD%B2"><span class="toc-number">5.8.</span> <span class="toc-text">2.8 部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-9-%E9%83%A8%E7%BD%B2%E5%A4%9A%E4%B8%AA%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.9.</span> <span class="toc-text">2.9 部署多个模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-10-%E5%9C%A8%E7%BA%BF%E8%AF%86%E5%88%AB"><span class="toc-number">5.10.</span> <span class="toc-text">2.10 在线识别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1"><span class="toc-number">6.</span> <span class="toc-text">3 数据统计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E8%AE%AD%E7%BB%83%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1"><span class="toc-number">6.1.</span> <span class="toc-text">3.1 训练数据统计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E5%92%8C%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="toc-number">6.2.</span> <span class="toc-text">3.2 压力测试和统计数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%BC%80%E5%8F%91%E8%AF%B4%E6%98%8E"><span class="toc-number">7.</span> <span class="toc-text">4 开发说明</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%B7%B2%E7%9F%A5BUG"><span class="toc-number">8.</span> <span class="toc-text">4 已知BUG</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">ZJH</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">9</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">14</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">8</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Zany's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">卷积神经网络实现图片验证码</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-10-30</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/">神经网络</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="cnn-captcha"><a href="#cnn-captcha" class="headerlink" title="cnn_captcha"></a>cnn_captcha</h1><p>use CNN recognize captcha by tensorflow.<br>本项目针对字符型图片验证码，使用tensorflow实现卷积神经网络，进行验证码识别。<br>项目封装了比较通用的<strong>校验、训练、验证、识别、API模块</strong>，极大的减少了识别字符型验证码花费的时间和精力。 </p>
<p>项目已经帮助很多同学高效完成了验证码识别任务。<br>如果你在使用过程中出现了bug和做了良好的改进，欢迎提出issue和PR，作者会尽快回复，希望能和你共同完善项目。 </p>
<p>如果你需要识别点选、拖拽类验证码，或者有目标检测需求，也可以参考这个项目<a target="_blank" rel="noopener" href="https://github.com/nickliqian/darknet_captcha">nickliqian/darknet_captcha</a>。</p>
<h1 id="时间表"><a href="#时间表" class="headerlink" title="时间表"></a>时间表</h1><h4 id="2018-11-12"><a href="#2018-11-12" class="headerlink" title="2018.11.12"></a>2018.11.12</h4><p>初版Readme.md  </p>
<h4 id="2018-11-21"><a href="#2018-11-21" class="headerlink" title="2018.11.21"></a>2018.11.21</h4><p>加入关于验证码识别的一些说明  </p>
<h4 id="2018-11-24"><a href="#2018-11-24" class="headerlink" title="2018.11.24"></a>2018.11.24</h4><p>优化校验数据集图片的规则  </p>
<h4 id="2018-11-26"><a href="#2018-11-26" class="headerlink" title="2018.11.26"></a>2018.11.26</h4><p>新增<code>train_model_v2.py</code>文件，训练过程中同时输出训练集和验证集的准确率  </p>
<h4 id="2018-12-06"><a href="#2018-12-06" class="headerlink" title="2018.12.06"></a>2018.12.06</h4><p>新增多模型部署支持，修复若干bug  </p>
<h4 id="2018-12-08"><a href="#2018-12-08" class="headerlink" title="2018.12.08"></a>2018.12.08</h4><p>优化模型识别速度，支持api压力测试和统计耗时  </p>
<h4 id="2019-02-19"><a href="#2019-02-19" class="headerlink" title="2019.02.19"></a>2019.02.19</h4><ol>
<li>新增一种准确率计算方式    </li>
<li>TAG: v1.0<h4 id="2019-04-12"><a href="#2019-04-12" class="headerlink" title="2019.04.12"></a>2019.04.12</h4></li>
<li>只保留一种<code>train_model.py</code>文件</li>
<li>优化代码结构</li>
<li>把通用配置抽取到<code>sample_config.json</code>和<code>captcha_config.json</code></li>
<li>修复若干大家在issue提出的问题<h4 id="2019-06-01"><a href="#2019-06-01" class="headerlink" title="2019.06.01"></a>2019.06.01</h4></li>
<li>完善readme文档，文档不长，请大家一定要读完~</li>
<li>使用cnnlib目录存放神经网络结构代码</li>
<li>做了一版训练数据统计，大家可以参考我们的训练次数、时长和准确率</li>
<li>TAG: v2.0  </li>
</ol>
<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><p>[toc]</p>
<h1 id="1-项目介绍"><a href="#1-项目介绍" class="headerlink" title="1 项目介绍"></a>1 项目介绍</h1><h2 id="1-1-关于验证码识别"><a href="#1-1-关于验证码识别" class="headerlink" title="1.1 关于验证码识别"></a>1.1 关于验证码识别</h2><p>验证码识别大多是爬虫会遇到的问题，也可以作为图像识别的入门案例。目前通常使用如下几种方法：  </p>
<table>
<thead>
<tr>
<th>方法名称</th>
<th>相关要点</th>
</tr>
</thead>
<tbody><tr>
<td>tesseract</td>
<td>仅适合识别没有干扰和扭曲的图片，训练起来很麻烦</td>
</tr>
<tr>
<td>其他开源识别库</td>
<td>不够通用，识别率未知</td>
</tr>
<tr>
<td>付费OCR API</td>
<td>需求量大的情形成本很高</td>
</tr>
<tr>
<td>图像处理+机器学习分类算法</td>
<td>涉及多种技术，学习成本高，且不通用</td>
</tr>
<tr>
<td>卷积神经网络</td>
<td>一定的学习成本，算法适用于多类验证码</td>
</tr>
</tbody></table>
<p>这里说一下使用传统的<strong>图像处理和机器学习算法</strong>，涉及多种技术：  </p>
<ol>
<li>图像处理</li>
</ol>
<ul>
<li>前处理（灰度化、二值化）</li>
<li>图像分割</li>
<li>裁剪（去边框）</li>
<li>图像滤波、降噪</li>
<li>去背景</li>
<li>颜色分离</li>
<li>旋转</li>
</ul>
<ol start="2">
<li>机器学习</li>
</ol>
<ul>
<li>KNN</li>
<li>SVM</li>
</ul>
<p>使用这类方法对使用者的要求较高，且由于图片的变化类型较多，处理的方法不够通用，经常花费很多时间去调整处理步骤和相关算法。<br>而使用<strong>卷积神经网络</strong>，只需要通过简单的前处理，就可以实现大部分静态字符型验证码的端到端识别，效果很好，通用性很高。  </p>
<p>这里列出目前<strong>常用的验证码</strong>生成库：</p>
<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/cynchanpin/p/6912301.html">Java验证全家桶</a>  </p>
</blockquote>
<table>
<thead>
<tr>
<th>语言</th>
<th>验证码库名称</th>
<th>链接</th>
<th>样例</th>
</tr>
</thead>
<tbody><tr>
<td>Java</td>
<td>JCaptcha</td>
<td><a target="_blank" rel="noopener" href="https://jcaptcha.atlassian.net/wiki/spaces/general/pages/1212427/Samples+tests">示例</a></td>
<td><img src="./readme_image/jcaptcha1.jpg" alt="效果1"> <img src="./readme_image/jcaptcha2.jpg" alt="效果2"> <img src="./readme_image/jcaptcha3.jpg" alt="效果3"></td>
</tr>
<tr>
<td>Java</td>
<td>JCaptcha4Struts2</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Java</td>
<td>SimpleCaptcha</td>
<td><a target="_blank" rel="noopener" href="https://www.oschina.net/p/simplecaptcha">例子</a></td>
<td><img src="./readme_image/SimpleCaptcha_1.jpg" alt="效果1"> <img src="./readme_image/SimpleCaptcha_2.jpg" alt="效果2"> <img src="./readme_image/SimpleCaptcha_3.jpg" alt="效果3"></td>
</tr>
<tr>
<td>Java</td>
<td>kaptcha</td>
<td><a target="_blank" rel="noopener" href="https://github.com/linghushaoxia/kaptcha">例子</a></td>
<td><img src="./readme_image/Kaptcha_5.png" alt="水纹效果"> <img src="./readme_image/Kaptcha_2.png" alt="鱼眼效果"> <img src="./readme_image/Kaptcha_3.png" alt="阴影效果"></td>
</tr>
<tr>
<td>Java</td>
<td>patchca</td>
<td></td>
<td><img src="./readme_image/patchca_1.png" alt="效果1"></td>
</tr>
<tr>
<td>Java</td>
<td>imageRandom</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Java</td>
<td>iCaptcha</td>
<td></td>
<td><img src="./readme_image/iCaptcha.jpg" alt="效果1"></td>
</tr>
<tr>
<td>Java</td>
<td>SkewPassImage</td>
<td></td>
<td><img src="./readme_image/SkewPassImage.jpg" alt="效果1"></td>
</tr>
<tr>
<td>Java</td>
<td>Cage</td>
<td></td>
<td><img src="./readme_image/Cage1.jpg" alt="效果1"> <img src="./readme_image/Cage2.jpg" alt="效果2"></td>
</tr>
<tr>
<td>Python</td>
<td>captcha</td>
<td><a target="_blank" rel="noopener" href="https://github.com/nickliqian/cnn_captcha/blob/master/gen_image/gen_sample_by_captcha.py">例子</a></td>
<td><img src="./readme_image/py_Captcha-1.jpg" alt="py_Captcha"></td>
</tr>
<tr>
<td>Python</td>
<td>pycapt</td>
<td><a target="_blank" rel="noopener" href="https://github.com/aboutmydreams/pycapt">例子</a></td>
<td><img src="https://github.com/aboutmydreams/pycapt/raw/master/img/do4.png" alt="pycapt"></td>
</tr>
<tr>
<td>PHP</td>
<td>Gregwar/Captcha</td>
<td><a target="_blank" rel="noopener" href="https://github.com/Gregwar/Captcha">文档</a></td>
<td></td>
</tr>
<tr>
<td>PHP</td>
<td>mewebstudio/captcha</td>
<td><a target="_blank" rel="noopener" href="https://github.com/mewebstudio/captcha">文档</a></td>
<td></td>
</tr>
</tbody></table>
<h2 id="1-2-目录结构"><a href="#1-2-目录结构" class="headerlink" title="1.2 目录结构"></a>1.2 目录结构</h2><h3 id="1-2-1-基本配置"><a href="#1-2-1-基本配置" class="headerlink" title="1.2.1 基本配置"></a>1.2.1 基本配置</h3><table>
<thead>
<tr>
<th>序号</th>
<th>文件名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><code>conf/</code></td>
<td>配置文件目录</td>
</tr>
<tr>
<td>2</td>
<td><code>sample/</code></td>
<td>数据集目录</td>
</tr>
<tr>
<td>3</td>
<td><code>model/</code></td>
<td>模型文件目录</td>
</tr>
<tr>
<td>4</td>
<td><code>cnnlib/</code></td>
<td>封装CNN的相关代码目录</td>
</tr>
</tbody></table>
<h3 id="1-2-2-训练模型"><a href="#1-2-2-训练模型" class="headerlink" title="1.2.2 训练模型"></a>1.2.2 训练模型</h3><table>
<thead>
<tr>
<th>序号</th>
<th>文件名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>verify_and_split_data.py</td>
<td>验证数据集、拆分数据为训练集和测试集</td>
</tr>
<tr>
<td>2</td>
<td>network.py</td>
<td>cnn网络基类</td>
</tr>
<tr>
<td>3</td>
<td>train_model.py</td>
<td>训练模型</td>
</tr>
<tr>
<td>4</td>
<td>test_batch.py</td>
<td>批量验证</td>
</tr>
<tr>
<td>5</td>
<td>gen_image/gen_sample_by_captcha.py</td>
<td>生成验证码的脚本</td>
</tr>
<tr>
<td>6</td>
<td>gen_image/collect_labels.py</td>
<td>用于统计验证码标签（常用于中文验证码）</td>
</tr>
</tbody></table>
<h3 id="1-2-3-web接口"><a href="#1-2-3-web接口" class="headerlink" title="1.2.3 web接口"></a>1.2.3 web接口</h3><table>
<thead>
<tr>
<th>序号</th>
<th>文件名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>webserver_captcha_image.py</td>
<td>获取验证码接口</td>
</tr>
<tr>
<td>2</td>
<td>webserver_recognize_api.py</td>
<td>提供在线识别验证码接口</td>
</tr>
<tr>
<td>3</td>
<td>recognize_online.py</td>
<td>使用接口识别的例子</td>
</tr>
<tr>
<td>4</td>
<td>recognize_local.py</td>
<td>测试本地图片的例子</td>
</tr>
<tr>
<td>5</td>
<td>recognize_time_test.py</td>
<td>压力测试识别耗时和请求响应耗时</td>
</tr>
</tbody></table>
<h2 id="1-3-依赖"><a href="#1-3-依赖" class="headerlink" title="1.3 依赖"></a>1.3 依赖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<p>注意：如果需要使用GPU进行训练，请把文件中的tenforflow修改为tensorflow-gpu</p>
<h2 id="1-4-模型结构"><a href="#1-4-模型结构" class="headerlink" title="1.4 模型结构"></a>1.4 模型结构</h2><table>
<thead>
<tr>
<th align="center">序号</th>
<th align="center">层级</th>
</tr>
</thead>
<tbody><tr>
<td align="center">输入</td>
<td align="center">input</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">卷积层 + 池化层 + 降采样层 + ReLU</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">卷积层 + 池化层 + 降采样层 + ReLU</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">卷积层 + 池化层 + 降采样层 + ReLU</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">全连接 + 降采样层 + Relu</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">全连接 + softmax</td>
</tr>
<tr>
<td align="center">输出</td>
<td align="center">output</td>
</tr>
</tbody></table>
<h1 id="2-如何使用"><a href="#2-如何使用" class="headerlink" title="2 如何使用"></a>2 如何使用</h1><h2 id="2-1-数据集"><a href="#2-1-数据集" class="headerlink" title="2.1 数据集"></a>2.1 数据集</h2><p>原始数据集可以存放在<code>./sample/origin</code>目录中。<br>为了便于处理，图片最好以<code>2e8j_17322d3d4226f0b5c5a71d797d2ba7f7.jpg</code>格式命名（标签_序列号.后缀）。 </p>
<p>如果你没有训练集，你可以使用<code>gen_sample_by_captcha.py</code>文件生成训练集文件。<br>生成之前你需要修改相关配置<code>conf/captcha_config.json</code>（路径、文件后缀、字符集等）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;root_dir&quot;: &quot;sample/origin/&quot;,  # 验证码保存路径</span><br><span class="line">  &quot;image_suffix&quot;: &quot;png&quot;,         # 验证码图片后缀</span><br><span class="line">  &quot;characters&quot;: &quot;0123456789&quot;,    # 生成验证码的可选字符</span><br><span class="line">  &quot;count&quot;: 1000,                 # 生成验证码的图片数量</span><br><span class="line">  &quot;char_count&quot;: 4,               # 每张验证码图片上的字符数量</span><br><span class="line">  &quot;width&quot;: 100,                  # 图片宽度</span><br><span class="line">  &quot;height&quot;: 60                   # 图片高度</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-配置文件"><a href="#2-2-配置文件" class="headerlink" title="2.2 配置文件"></a>2.2 配置文件</h2><p>创建一个新项目前，需要自行<strong>修改相关配置文件</strong><code>conf/sample_config.json</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;origin_image_dir&quot;: &quot;sample/origin/&quot;,  # 原始文件</span><br><span class="line">  &quot;new_image_dir&quot;: &quot;sample/new_train/&quot;,  # 新的训练样本</span><br><span class="line">  &quot;train_image_dir&quot;: &quot;sample/train/&quot;,    # 训练集</span><br><span class="line">  &quot;test_image_dir&quot;: &quot;sample/test/&quot;,      # 测试集</span><br><span class="line">  &quot;api_image_dir&quot;: &quot;sample/api/&quot;,        # api接收的图片储存路径</span><br><span class="line">  &quot;online_image_dir&quot;: &quot;sample/online/&quot;,  # 从验证码url获取的图片的储存路径</span><br><span class="line">  &quot;local_image_dir&quot;: &quot;sample/local/&quot;,    # 本地保存图片的路径</span><br><span class="line">  &quot;model_save_dir&quot;: &quot;model/&quot;,            # 从验证码url获取的图片的储存路径</span><br><span class="line">  &quot;image_width&quot;: 100,                    # 图片宽度</span><br><span class="line">  &quot;image_height&quot;: 60,                    # 图片高度</span><br><span class="line">  &quot;max_captcha&quot;: 4,                      # 验证码字符个数</span><br><span class="line">  &quot;image_suffix&quot;: &quot;png&quot;,                 # 图片文件后缀</span><br><span class="line">  &quot;char_set&quot;: &quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;,  # 验证码识别结果类别</span><br><span class="line">  &quot;use_labels_json_file&quot;: false,                       # 是否开启读取`labels.json`内容</span><br><span class="line">  &quot;remote_url&quot;: &quot;http://127.0.0.1:6100/captcha/&quot;,      # 验证码远程获取地址</span><br><span class="line">  &quot;cycle_stop&quot;: 3000,                                  # 启动任务后的训练指定次数后停止</span><br><span class="line">  &quot;acc_stop&quot;: 0.99,                                    # 训练到指定准确率后停止</span><br><span class="line">  &quot;cycle_save&quot;: 500,                                   # 训练指定次数后定时保存模型</span><br><span class="line">  &quot;enable_gpu&quot;: 0,                                     # 是否开启GUP训练</span><br><span class="line">  &quot;train_batch_size&quot;: 128,                             # 训练时每次使用的图片张数，如果CPU或者GPU内存太小可以减少这个参数</span><br><span class="line">  &quot;test_batch_size&quot;: 100                               # 每批次测试时验证的图片张数，不要超过验证码集的总数</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>关于<code>验证码识别结果类别</code>，假设你的样本是中文验证码，你可以使用<code>tools/collect_labels.py</code>脚本进行标签的统计。<br>会生成文件<code>gen_image/labels.json</code>存放所有标签，在配置文件中设置<code>use_labels_json_file = True</code>开启读取<code>labels.json</code>内容作为<code>结果类别</code>。</p>
<h2 id="2-3-验证和拆分数据集"><a href="#2-3-验证和拆分数据集" class="headerlink" title="2.3 验证和拆分数据集"></a>2.3 验证和拆分数据集</h2><p>此功能会校验原始图片集的尺寸和测试图片是否能打开，并按照19:1的比例拆分出训练集和测试集。<br>所以需要分别创建和指定三个文件夹：origin，train，test用于存放相关文件。</p>
<p>也可以修改为不同的目录，但是最好修改为绝对路径。<br>文件夹创建好之后，执行以下命令即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 verify_and_split_data.py</span><br></pre></td></tr></table></figure>
<p>一般会有类似下面的提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 开始校验目录：[sample/origin/]</span><br><span class="line">开始校验原始图片集</span><br><span class="line">原始集共有图片: 1001张</span><br><span class="line">====以下1张图片有异常====</span><br><span class="line">[第0张图片] [.DStore] [文件后缀不正确]</span><br><span class="line">========end</span><br><span class="line">开始分离原始图片集为：测试集（5%）和训练集（95%）</span><br><span class="line">共分配1000张图片到训练集和测试集，其中1张为异常留在原始目录</span><br><span class="line">测试集数量为：50</span><br><span class="line">训练集数量为：950</span><br><span class="line">&gt;&gt;&gt; 开始校验目录：[sample/new_train/]</span><br><span class="line">【警告】找不到目录sample/new_train/，即将创建</span><br><span class="line">开始校验原始图片集</span><br><span class="line">原始集共有图片: 0张</span><br><span class="line">====以下0张图片有异常====</span><br><span class="line">未发现异常（共 0 张图片）</span><br><span class="line">========end</span><br><span class="line">开始分离原始图片集为：测试集（5%）和训练集（95%）</span><br><span class="line">共分配0张图片到训练集和测试集，其中0张为异常留在原始目录</span><br><span class="line">测试集数量为：0</span><br><span class="line">训练集数量为：0</span><br></pre></td></tr></table></figure>
<p>程序会同时校验和分割<code>origin_image_dir</code>和<code>new_image_dir</code>两个目录中的图片；后续有了更多的样本，可以把样本放在<code>new_image_dir</code>目录中再次执行<code>verify_and_split_data</code>。<br>程序会把无效的文件留在原文件夹。  </p>
<p>此外，当你有新的样本需要一起训练，可以放在<code>sample/new</code>目录下，再次运行<code>python3 verify_and_split_data.py</code>即可。<br>需要注意的是，如果新的样本中有新增的标签，你需要把新的标签增加到<code>char_set</code>配置中或者<code>labels.json</code>文件中。 </p>
<h2 id="2-4-训练模型"><a href="#2-4-训练模型" class="headerlink" title="2.4 训练模型"></a>2.4 训练模型</h2><p>创建好训练集和测试集之后，就可以开始训练模型了。<br>训练的过程中会输出日志，日志展示当前的训练轮数、准确率和loss。<br><strong>此时的准确率是训练集图片的准确率，代表训练集的图片识别情况</strong><br>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">第10次训练 &gt;&gt;&gt; </span><br><span class="line">[训练集] 字符准确率为 0.03000 图片准确率为 0.00000 &gt;&gt;&gt; loss 0.1698757857</span><br><span class="line">[验证集] 字符准确率为 0.04000 图片准确率为 0.00000 &gt;&gt;&gt; loss 0.1698757857</span><br></pre></td></tr></table></figure>
<p>字符准确率和图片准确率的解释：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">假设：有100张图片，每张图片四个字符，共400个字符。我们这里把任务拆分为为需要识别400个字符</span><br><span class="line">字符准确率：识别400的字符中，正确字符的占比。</span><br><span class="line">图片准确率：100张图片中，4个字符完全识别准确的图片占比。</span><br></pre></td></tr></table></figure>
<p>这里不具体介绍tensorflow安装相关问题，直奔主题。<br>确保图片相关参数和目录设置正确后，执行以下命令开始训练：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 train_model.py</span><br></pre></td></tr></table></figure>
<p>也可以根据<code>train_model.py</code>的<code>main</code>函数中的代码调用类开始训练或执行一次简单的识别演示。  </p>
<p>由于训练集中常常不包含所有的样本特征，所以会出现训练集准确率是100%而测试集准确率不足100%的情况，此时提升准确率的一个解决方案是增加正确标记后的负样本。</p>
<h2 id="2-5-批量验证"><a href="#2-5-批量验证" class="headerlink" title="2.5 批量验证"></a>2.5 批量验证</h2><p>使用测试集的图片进行验证，输出准确率。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 test_batch.py</span><br></pre></td></tr></table></figure>
<p>同样可以根据<code>main</code>函数中的代码调用类开始验证。</p>
<h2 id="2-6-启动WebServer"><a href="#2-6-启动WebServer" class="headerlink" title="2.6 启动WebServer"></a>2.6 启动WebServer</h2><p>项目已经封装好加载模型和识别图片的类，启动<code>web server</code>后调用接口就可以使用识别服务。<br>启动<code>web server</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 webserver_recognize_api.py</span><br></pre></td></tr></table></figure>
<p>接口url为<code>http://127.0.0.1:6000/b</code></p>
<h2 id="2-7-调用接口识别"><a href="#2-7-调用接口识别" class="headerlink" title="2.7 调用接口识别"></a>2.7 调用接口识别</h2><p>使用requests调用接口:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url = &quot;http://127.0.0.1:6000/b&quot;</span><br><span class="line">files = &#123;&#x27;image_file&#x27;: (image_file_name, open(&#x27;captcha.jpg&#x27;, &#x27;rb&#x27;), &#x27;application&#x27;)&#125;</span><br><span class="line">r = requests.post(url=url, files=files)</span><br></pre></td></tr></table></figure>
<p>返回的结果是一个json：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &#x27;time&#x27;: &#x27;1542017705.9152594&#x27;,</span><br><span class="line">    &#x27;value&#x27;: &#x27;jsp1&#x27;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>文件<code>recognize_local.py</code>是使用接口识别本地的例子，这个例子运行成功，那么识别验证码的一套流程基本上是走了一遍了。<br>在线识别验证码是显示中常用场景，文件<code>recognize_online.py</code>是使用接口在线识别的例子，参见：<code>## 2.11 在线识别</code>。</p>
<h2 id="2-8-部署"><a href="#2-8-部署" class="headerlink" title="2.8 部署"></a>2.8 部署</h2><p>部署的时候，把<code>webserver_recognize_api.py</code>文件的最后一行修改为如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.run(host=&#x27;0.0.0.0&#x27;,port=5000,debug=False)</span><br></pre></td></tr></table></figure>
<p>然后开启端口访问权限，就可以通过外网访问了。<br>另外为了开启多进程处理请求，可以使用uwsgi+nginx组合进行部署。<br>这部分可以参考：<a target="_blank" rel="noopener" href="http://docs.jinkan.org/docs/flask/deploying/index.html">Flask部署选择</a></p>
<h2 id="2-9-部署多个模型"><a href="#2-9-部署多个模型" class="headerlink" title="2.9 部署多个模型"></a>2.9 部署多个模型</h2><p>部署多个模型:<br>在<code>webserver_recognize_api.py</code>文件汇总，新建一个Recognizer对象；<br>并参照原有<code>up_image</code>函数编写的路由和识别逻辑。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Q = Recognizer(image_height, image_width, max_captcha, char_set, model_save_dir)</span><br></pre></td></tr></table></figure>
<p>注意修改这一行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = Q.rec_image(img)</span><br></pre></td></tr></table></figure>

<h2 id="2-10-在线识别"><a href="#2-10-在线识别" class="headerlink" title="2.10 在线识别"></a>2.10 在线识别</h2><p>在线识别验证码是显示中常用场景，即实时获取目标验证码来调用接口进行识别。<br>为了测试的完整性，这里搭建了一个验证码获取接口，通过执行下面的命令启动：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python webserver_captcha_image.py</span><br></pre></td></tr></table></figure>
<p>启动后通过访问此地址：<code>http://127.0.0.1:6100/captcha/</code>可以接收到验证码图片的二进制流文件。<br>具体进行在线识别任务的demo参见：<code>recognize_online.py</code>。  </p>
<h1 id="3-数据统计"><a href="#3-数据统计" class="headerlink" title="3 数据统计"></a>3 数据统计</h1><h2 id="3-1-训练数据统计"><a href="#3-1-训练数据统计" class="headerlink" title="3.1 训练数据统计"></a>3.1 训练数据统计</h2><p>由于很多同学提出，“需要训练多久呀？”、“准确率可以达到多少？”、“为什么我的准确率一直是0？”类似的疑问。<br>这一小节，使用默认配置（2019.06.02），把训练过程中的数据做了统计，给大家做一个展示。<br>本次测试条件如下：</p>
<ul>
<li>验证码：本项目自带生成验证码程序，数字+小写英文</li>
<li>数量：20000张</li>
<li>计算引擎：GPU</li>
<li>GPU型号：笔记本，GTX 950X 2G显卡</li>
</ul>
<p>经过测试：<br>5000次，25分钟，<strong>训练集</strong>字符准确率84%，图片准确率51%；<br>9190次，46分钟，<strong>训练集</strong>字符准确率100%，图片准确率100%；<br>12000，60分钟，<strong>测试集</strong>的准确率基本上已经跑不动了。  </p>
<p>使用<code>test_batch.py</code>测试，日志如下：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">100个样本识别耗时6.513171672821045秒，准确率37.0%</span><br></pre></td></tr></table></figure>
<p>有37%的准确率，可以说是识别成功的第一步了。  </p>
<p>曲线图如下：<br>训练集-<br><img src="readme_image/train_acc.png" alt="train_acc"> </p>
<p>测试集-<br><img src="readme_image/test_acc.png" alt="test_acc">  </p>
<h2 id="3-2-压力测试和统计数据"><a href="#3-2-压力测试和统计数据" class="headerlink" title="3.2 压力测试和统计数据"></a>3.2 压力测试和统计数据</h2><p>提供了一个简易的压力测试脚本，可以统计api运行过程中识别耗时和请求耗时的相关数据，不过图需要自己用Excel拉出来。<br>打开文件<code>recognize_time_test.py</code>，修改<code>main</code>函数下的<code>test_file</code>路径，这里会重复使用一张图片来访问是被接口。<br>最后数据会储存在test.csv文件中。<br>使用如下命令运行：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python3 recognize_time_test.py</span><br><span class="line">----输出如下</span><br><span class="line">2938,5150,13:30:25,总耗时：29ms,识别：15ms,请求：14ms</span><br><span class="line">2939,5150,13:30:25,总耗时：41ms,识别：21ms,请求：20ms</span><br><span class="line">2940,5150,13:30:25,总耗时：47ms,识别：16ms,请求：31ms</span><br></pre></td></tr></table></figure>
<p>这里对一个模型进行了两万次测试后，一组数据test.csv。<br>把test.csv使用箱线图进行分析后可以看到：<br><img src="readme_image/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.png" alt="压力测试结果">  </p>
<ul>
<li>单次请求API总耗时（平均值）：27ms  </li>
<li>单次识别耗时（平均值）：12ms  </li>
<li>每次请求耗时（平均值）：15ms<br>其中有：请求API总耗时 = 识别耗时 + 请求耗时  </li>
</ul>
<h1 id="4-开发说明"><a href="#4-开发说明" class="headerlink" title="4 开发说明"></a>4 开发说明</h1><ul>
<li>20190209  </li>
</ul>
<ol>
<li>目前tensorboard展示支持的不是很好。</li>
</ol>
<ul>
<li>20190601</li>
</ul>
<ol>
<li>最近比较忙，issue回的有点慢，请大家见谅</li>
<li>dev分支开发到一半一直没时间弄，今天儿童节花了一下午时间更新了一下:)</li>
<li>感谢看到这里的你，谢谢你的支持</li>
</ol>
<h1 id="4-已知BUG"><a href="#4-已知BUG" class="headerlink" title="4 已知BUG"></a>4 已知BUG</h1><ol>
<li><p>使用pycharm启动recognize_api.py文件报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2018-12-01 00:35:15.106333: W T:\src\github\tensorflow\tensorflow\core\framework\op_kernel.cc:1273] OP_REQUIRES failed at save_restore_tensor.cc:170 : Invalid argument: Unsuccessful TensorSliceReader constructor: Failed to get matching files on ./model/: Not found: FindFirstFile failed for: ./model : ϵͳ�Ҳ���ָ����·����</span><br><span class="line">; No such process</span><br><span class="line">......</span><br><span class="line">tensorflow.python.framework.errors_impl.InvalidArgumentError: Unsuccessful TensorSliceReader constructor: Failed to get matching files on ./model/: Not found: FindFirstFile failed for: ./model : ϵͳ\udcd5Ҳ\udcbb\udcb5\udcbdָ\udcb6\udca8\udcb5\udcc4·\udcbe\udcb6\udca1\udca3</span><br><span class="line">; No such process</span><br><span class="line">	 [[Node: save/RestoreV2 = RestoreV2[dtypes=[DT_FLOAT, DT_FLOAT, DT_FLOAT, DT_FLOAT, DT_FLOAT, DT_FLOAT, DT_FLOAT, DT_FLOAT, DT_FLOAT, DT_FLOAT], _device=&quot;/job:localhost/replica:0/task:0/device:CPU:0&quot;](_arg_save/Const_0_0, save/RestoreV2/tensor_names, save/RestoreV2/shape_and_slices)]]</span><br></pre></td></tr></table></figure>
<p>由pycharm默认设置了工作空间，导致读取相对路径的model文件夹出错。<br>解决办法：编辑运行配置，设置工作空间为项目目录即可。<br><img src="readme_image/bug_api%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5.png" alt="bug_api启动失败"></p>
</li>
<li><p>FileNotFoundError: [Errno 2] No such file or directory: ‘xxxxxx’<br>目录下有文件夹不存在，在指定目录创建好文件夹即可。</p>
</li>
<li><p>api程序在运行过程中内存越占越大<br>结果查阅资料：<a target="_blank" rel="noopener" href="https://blog.csdn.net/The_lastest/article/details/81130500">链接</a><br>在迭代循环时，不能再包含任何张量的计算表达式，否在会内存溢出。<br>将张量的计算表达式放到init初始化执行后，识别速度得到极大的提升。</p>
</li>
<li><p>加载多个模型报错<br>原因是两个Recognizer对象都使用了默认的Graph。<br>解决办法是在创建对象的时候不使用默认Graph，新建graph，这样每个Recognizer都使用不同的graph，就不会冲突了。</p>
</li>
<li><p>Flask程序用于生产<br>可以参考官方文档：<a target="_blank" rel="noopener" href="http://docs.jinkan.org/docs/flask/config.html">Flask的生产配置</a></p>
</li>
<li><p>OOM happens</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hint: If you want to see a list of allocated tensors when OOM happens,</span><br><span class="line">add report_tensor_allocations_upon_oom to RunOptions for current allocation info.</span><br></pre></td></tr></table></figure>
<p>尽可能关闭其他占用GPU或者CPU的任务，或者减小<code>sample_config.json</code>中的<code>train_batch_size</code>参数。</p>
</li>
</ol>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">ZJH</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/10/29/神经网络/cnn_captcha/">http://example.com/2022/10/29/神经网络/cnn_captcha/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com">Zany's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/">神经网络</a><a class="post-meta__tags" href="/tags/cnn/">cnn</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2022/09/16/%E8%84%9A%E6%9C%AC/DingDing-Automatic-Clock-in-master/DingDing-Automatic-Clock-in/"><span>钉钉全自动打卡</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2023 By ZJH</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>